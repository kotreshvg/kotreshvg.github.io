"use strict";(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[589],{1003:(e,s,a)=>{a.d(s,{A:()=>t});a(9950);const t=a.p+"static/media/arrow-left-solid.07f8c39113e8fb15b640ecafe6256813.svg"},3589:(e,s,a)=>{a.r(s),a.d(s,{default:()=>N});var t=a(9950),o=a(9881),r=a(6033),i=a(4577),n=a(5009),l=a(4806),c=a.n(l),d=a(1182),u=a(4613),m=a(346),g=a(897),p=a(1003),h=a(6039),x=a(4414);const v=e=>{const[s,a]=(0,t.useState)({name:"",age:""});return(0,x.jsxs)(c(),{isOpen:e.isOpen,shouldCloseOnOverlayClick:!0,style:{content:{top:"50%",left:"50%",right:"auto",width:"80%",height:"40%",bottom:"auto",transform:"translate(-50%, -50%)",backgroundColor:"#FFFAED"},overlay:{backgroundColor:"#595959"}},children:[(0,x.jsx)("p",{className:"text-sm mb-4",children:"Below Fields are required for using group chat"}),(0,x.jsxs)("div",{className:"flex",children:[(0,x.jsx)("p",{className:"mx-2 w-1/2 text-sm",children:"Name"}),(0,x.jsx)("input",{placeholder:"John Doe",className:"rounded text-sm px-2 py-1 outline-none border border-amber-200",type:"text",maxLength:10,value:s.name,onChange:e=>{a({...s,name:e.target.value,age:0})}})]}),(0,x.jsxs)("div",{className:"flex mt-2",children:[(0,x.jsx)("p",{className:"mx-2 w-1/2 text-sm",children:"Age"}),(0,x.jsx)("input",{placeholder:"20",className:"rounded text-sm px-2 py-1 outline-none border border-amber-200",type:"number",value:s.age,onChange:e=>{a({...s,age:e.target.value})}})]}),(0,x.jsx)("button",{onClick:a=>{a.preventDefault(),d.a.extractUserName(s.name)&&parseInt(s.age)>0&&e.save(d.a.extractUserName(s.name),parseInt(s.age))},className:"bg-[#8ef57e] py-2 float-right mt-4 px-4 rounded-full text-sm shadow-edge",children:"Continue"})]})},N=e=>{var s,a;const[l,c]=(0,t.useState)({redirect:void 0,Socket:void 0,activegroup:void 0,groupExpanded:void 0,chatMenuVisible:!1,groupsJoined:[],message:"",userName:"stranger"}),[d,N]=(0,t.useState)(!1),[f,w]=(0,t.useState)([]),[j,b]=(0,t.useReducer)((e=>e+1),0);(0,t.useEffect)((()=>{setTimeout((()=>{N(!0)}),2e3)}),[]);const y=()=>{setTimeout((e=>{var s;null===(s=document.getElementById("end"))||void 0===s||s.scrollIntoView({behavior:"smooth",block:"nearest"})}),100)};(0,t.useEffect)((()=>((0,n.V)().then((e=>{let s=[...e.data.Groups.map((e=>{let s=JSON.parse(e);return s.time=new Date(s.time),s}))];c((e=>(w(s),{...e,availableGroups:s})))})),(new m.D).getSocket().then((e=>{c({...l,Socket:e}),e.on("group joined",(e=>{console.log("joined"),u.Ay.success("joined ".concat(e.groupName)),c((s=>({...s,groupsJoined:[...s.groupsJoined,...s.availableGroups.filter((s=>s.groupName===e.groupName))]})))})),e.on("chat message",(e=>{e=JSON.parse(e),window.chatHistory[e.groupName].chatList.push(e),c((s=>{var a;return console.log(s.activegroup,e.groupName),void 0===s.activegroup|!(e.groupName===(null===(a=s.activegroup)||void 0===a?void 0:a.groupName))&&(window.chatHistory[e.groupName].unreadCount++,(0,u.Ay)("received msg ".concat(e.groupName),{icon:(0,x.jsx)("img",{src:g.A,width:"20px",className:"rounded-full"}),style:{background:"#FFE900",borderRadius:"10px"}})),s})),b(),y()})),e.on("message history",(e=>{console.log(e);let s=window.chatHistory;if(s){console.log(s);let a=s[e.groupName]?[...s[e.groupName]]:[];window.chatHistory={...window.chatHistory,[e.groupName]:{unreadCount:0,chatList:[...a,...e.messages.map((e=>JSON.parse(e)))]}}}else window.chatHistory={[e.groupName]:{unreadCount:0,chatList:[...e.messages.map((e=>JSON.parse(e)))]}};b(),y()}))})),()=>{l.Socket&&l.Socket.disconnect()})),[]),(0,t.useEffect)((()=>{var e;window.chatHistory&&window.chatHistory[null===(e=l.activegroup)||void 0===e?void 0:e.groupName]&&(window.chatHistory[l.activegroup.groupName].unreadCount=0)}),[l.activegroup]);return(0,x.jsxs)(t.Fragment,{children:[(0,x.jsx)(u.l$,{}),(0,x.jsx)(v,{isOpen:d,save:(e,s)=>{c({...l,userName:e,age:s}),N(!1)}}),(0,x.jsx)("div",{className:"w-full p-2 min-h-[95vh] bg-gradient-to-r from-[#FFFAED] to-white border-r border-[#E9BB19]",children:l.activegroup?(0,x.jsxs)("div",{children:[(0,x.jsxs)("div",{className:"grid grid-cols-8 h-fit p-2 justify-between items-center w-full  bg-[#FFF7E1] rounded shadow-edge",children:[(0,x.jsx)("img",{onClick:e=>{e.preventDefault(),c({...l,activegroup:void 0})},className:"col-start-1",src:p.A,alt:"back icon",width:"16px"}),(0,x.jsx)("div",{className:"w-8 col-start-2 h-8 rounded-full p-2 bg-white flex justify-center items-center",children:(0,x.jsx)("img",{className:"rounded-full",src:o.A,alt:"user"})}),(0,x.jsx)("h4",{className:"col-span-5 text-sm",children:null===(s=l.activegroup)||void 0===s?void 0:s.groupName}),(0,x.jsx)("img",{className:"hover:bg-[#f8f1df] col-span-1 rounded-full px-1",src:i.A,alt:"menu"})]}),(0,x.jsxs)("div",{className:"h-[80vh] overflow-auto scroll-none scroll-hide bg-gradient-to-r from-[#FFFAED] to-white ",children:[l.activegroup&&!l.groupsJoined.filter((e=>e.groupName===l.activegroup.groupName)).length?(0,x.jsx)("div",{className:"w-full flex justify-center pt-2",children:(0,x.jsx)("button",{onClick:e=>{e.preventDefault(),l.Socket&&l.Socket.emit("joinRequest",{groupName:l.activegroup.groupName})},className:"py-1 px-4 hover:scale-105 text-dark_grey hover:text-black bg-[#8ef57e] rounded-full text-sm",children:"Join"})}):"",window.chatHistory&&l.activegroup&&(null===(a=window.chatHistory[l.activegroup.groupName])||void 0===a?void 0:a.chatList.map(((e,s)=>{let a=e.time.split("T");return(0,x.jsxs)("div",{className:"my-4",children:[(0,x.jsxs)("p",{className:"text-[9px] text-gray-600",children:[a[0]," / ",a[1].substring(0,8)," ",e.author]}),(0,x.jsxs)("div",{className:"py-2 px-4 mx-1 rounded-sm shadow-edge bg-white w-fit max-w-[50%] text-sm",children:[e.message,s+1==window.chatHistory[l.activegroup.groupName].chatList.length?(0,x.jsx)("div",{id:"end"}):""]})]},e.message)})))]}),(0,x.jsxs)("div",{className:" flex h-fit",children:[(0,x.jsx)("input",{value:l.message,onChange:e=>{e.preventDefault(),c({...l,message:e.target.value})},className:" border-oxford_blue p-1 rounded-xl border h-10 w-[100%]",type:"text"}),(0,x.jsx)("div",{onClick:e=>{e.preventDefault(),console.log(l.message,l.userName),l.Socket&&l.userName&&l.activegroup&&l.groupsJoined.filter((e=>e.groupName===l.activegroup.groupName)).length?(l.Socket.emit("chat message",{author:l.userName,message:l.message,groupName:l.activegroup.groupName}),c({...l,message:""})):(c({...l,alertMsg:"join group before sending message",alertType:"warning"}),u.Ay.error("you've not joined this group"))},children:(0,x.jsx)("img",{src:r.A,className:"",width:"40px",alt:"send icon"})})]})]}):(0,x.jsxs)("div",{className:"",children:[(0,x.jsx)("div",{className:"p-1 ",children:"Lounge"}),(0,x.jsx)("div",{className:"text-gray-600 text-xs flex justify-center",children:(0,x.jsx)("p",{children:"Available Groups"})}),(0,x.jsx)("div",{className:"Grpcontainer min-h-[80vh]",children:null===f||void 0===f?void 0:f.map(((e,s)=>(0,x.jsxs)("div",{onClick:()=>{c((e=>(y(),{...e,activegroup:{...f[s]}})))},className:"w-full bg-gradient-to-r from-[#FFF5DA] rounded-md p-2 my-2 to-white shadow-tile flex hover:scale-105 cursor-pointer",children:[(0,x.jsx)("div",{className:"w-8 h-8 rounded-full p-2 bg-white flex justify-center items-center",children:(0,x.jsx)("img",{className:"rounded-full",src:o.A,alt:"user"})}),(0,x.jsxs)("div",{className:"mx-2 w-[80%] flex items-center",children:[(0,x.jsx)("div",{className:"font-light text-sm w-1/2",children:e.groupName}),(0,x.jsxs)("div",{className:"w-1/2 border-l p-1 border-[#E9BB19] text-[8px]",children:[e.description.substring(0,20)," ..."]}),window.chatHistory&&window.chatHistory[e.groupName]&&window.chatHistory[e.groupName].unreadCount?(0,x.jsx)("div",{className:"py-1 px-2 float-right text-white font-black text-xs bg-amber-400 rounded",children:window.chatHistory[e.groupName].unreadCount}):""]})]},e.groupName)))}),(0,x.jsxs)("div",{onClick:e=>{e.preventDefault(),u.Ay.loading("Upcoming feature, will be availablel soon",{duration:2500})},className:"px-4 mx-auto py-2 rounded-full w-fit flex shadow-edge bg-[#8ef57e] text-xs",children:[(0,x.jsx)("img",{src:h.A,alt:"add group",width:"20px"}),(0,x.jsx)("button",{className:"mx-1",children:"Add Group"})]})]})})]})}}}]);