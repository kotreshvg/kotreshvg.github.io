"use strict";(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[589],{1003:(e,t,a)=>{a.d(t,{A:()=>s});a(9950);const s=a.p+"static/media/arrow-left-solid.07f8c39113e8fb15b640ecafe6256813.svg"},3589:(e,t,a)=>{a.r(t),a.d(t,{default:()=>f});var s=a(9950),o=a(9881),r=a(6033),i=a(4577),l=a(5009),n=a(4806),c=a.n(n),d=a(1182),u=a(4613),m=a(346),g=a(897),p=a(1003),h=a(6039),x=a(9749),v=a(4414);const N=e=>{const[t,a]=(0,s.useState)({name:"",age:""});return(0,v.jsxs)(c(),{isOpen:e.isOpen,shouldCloseOnOverlayClick:!0,style:{content:{top:"50%",left:"50%",right:"auto",width:"80%",height:"40%",bottom:"auto",transform:"translate(-50%, -50%)",backgroundColor:"#FFFAED"},overlay:{backgroundColor:"#595959"}},children:[(0,v.jsx)("p",{className:"text-sm mb-4",children:"Below Fields are required for using group chat"}),(0,v.jsxs)("div",{className:"flex",children:[(0,v.jsx)("p",{className:"mx-2 w-1/2 text-sm",children:"Name"}),(0,v.jsx)("input",{placeholder:"John Doe",className:"rounded text-sm px-2 py-1 outline-none border border-amber-200",type:"text",maxLength:10,value:t.name,onChange:e=>{a({...t,name:e.target.value,age:0})}})]}),(0,v.jsxs)("div",{className:"flex mt-2",children:[(0,v.jsx)("p",{className:"mx-2 w-1/2 text-sm",children:"Age"}),(0,v.jsx)("input",{placeholder:"20",className:"rounded text-sm px-2 py-1 outline-none border border-amber-200",type:"number",value:t.age,onChange:e=>{a({...t,age:e.target.value})}})]}),(0,v.jsx)("button",{onClick:a=>{a.preventDefault(),d.a.extractUserName(t.name)&&parseInt(t.age)>0&&e.save(d.a.extractUserName(t.name),parseInt(t.age))},className:"bg-[#8ef57e] py-2 float-right mt-4 px-4 rounded-full text-sm shadow-edge",children:"Continue"})]})},f=e=>{var t,a;const[n,c]=(0,s.useState)({redirect:void 0,Socket:void 0,activegroup:void 0,groupExpanded:void 0,chatMenuVisible:!1,groupsJoined:[],message:"",userName:x.A.getState().authentication.userName||localStorage.getItem("userName")||""}),[d,f]=(0,s.useState)(!1),[w,j]=(0,s.useState)([]),[b,y]=(0,s.useReducer)((e=>e+1),0);(0,s.useEffect)((()=>{setTimeout((()=>{f(!0)}),2e3)}),[]);const k=()=>{setTimeout((e=>{var t;null===(t=document.getElementById("end"))||void 0===t||t.scrollIntoView({behavior:"smooth",block:"nearest"})}),100)};(0,s.useEffect)((()=>((0,l.V)().then((e=>{let t=[...e.data.Groups.map((e=>{let t=JSON.parse(e);return t.time=new Date(t.time),t}))];c((e=>(j(t),{...e,availableGroups:t})))})),(new m.D).getSocket().then((e=>{c({...n,Socket:e}),e.on("group joined",(e=>{console.log("joined"),u.Ay.success("joined ".concat(e.groupName)),c((t=>({...t,groupsJoined:[...t.groupsJoined,...t.availableGroups.filter((t=>t.groupName===e.groupName))]})))})),e.on("chat message",(e=>{e=JSON.parse(e),window.chatHistory[e.groupName].chatList.push(e),c((t=>{var a;return console.log(t.activegroup,e.groupName),void 0===t.activegroup|!(e.groupName===(null===(a=t.activegroup)||void 0===a?void 0:a.groupName))&&(window.chatHistory[e.groupName].unreadCount++,(0,u.Ay)("received msg ".concat(e.groupName),{icon:(0,v.jsx)("img",{src:g.A,width:"20px",className:"rounded-full"}),style:{background:"#FFE900",borderRadius:"10px"}})),t})),y(),k()})),e.on("message history",(e=>{console.log(e);let t=window.chatHistory;if(t){console.log(t);let a=t[e.groupName]?[...t[e.groupName]]:[];window.chatHistory={...window.chatHistory,[e.groupName]:{unreadCount:0,chatList:[...a,...e.messages.map((e=>JSON.parse(e)))]}}}else window.chatHistory={[e.groupName]:{unreadCount:0,chatList:[...e.messages.map((e=>JSON.parse(e)))]}};y(),k()}))})),()=>{n.Socket&&n.Socket.disconnect()})),[]),(0,s.useEffect)((()=>{var e;window.chatHistory&&window.chatHistory[null===(e=n.activegroup)||void 0===e?void 0:e.groupName]&&(window.chatHistory[n.activegroup.groupName].unreadCount=0)}),[n.activegroup]);return(0,v.jsxs)(s.Fragment,{children:[(0,v.jsx)(u.l$,{}),""===n.userName&&(0,v.jsx)(N,{isOpen:d,save:(e,t)=>{c({...n,userName:e,age:t}),f(!1)}}),(0,v.jsx)("div",{className:"w-full p-2 min-h-[95vh] bg-gradient-to-r from-[#FFFAED] to-white border-r border-[#E9BB19]",children:n.activegroup?(0,v.jsxs)("div",{children:[(0,v.jsxs)("div",{className:"grid grid-cols-8 h-fit p-2 justify-between items-center w-full  bg-[#FFF7E1] rounded shadow-edge",children:[(0,v.jsx)("img",{onClick:e=>{e.preventDefault(),c({...n,activegroup:void 0})},className:"col-start-1",src:p.A,alt:"back icon",width:"16px"}),(0,v.jsx)("div",{className:"w-8 col-start-2 h-8 rounded-full p-2 bg-white flex justify-center items-center",children:(0,v.jsx)("img",{className:"rounded-full",src:o.A,alt:"user"})}),(0,v.jsx)("h4",{className:"col-span-5 text-sm",children:null===(t=n.activegroup)||void 0===t?void 0:t.groupName}),(0,v.jsx)("img",{className:"hover:bg-[#f8f1df] col-span-1 rounded-full px-1",src:i.A,alt:"menu"})]}),(0,v.jsxs)("div",{className:"h-[80vh] overflow-auto scroll-none scroll-hide bg-gradient-to-r from-[#FFFAED] to-white ",children:[n.activegroup&&!n.groupsJoined.filter((e=>e.groupName===n.activegroup.groupName)).length?(0,v.jsx)("div",{className:"w-full flex justify-center pt-2",children:(0,v.jsx)("button",{onClick:e=>{e.preventDefault(),n.Socket&&n.Socket.emit("joinRequest",{groupName:n.activegroup.groupName})},className:"py-1 px-4 hover:scale-105 text-dark_grey hover:text-black bg-[#8ef57e] rounded-full text-sm",children:"Join"})}):"",window.chatHistory&&n.activegroup&&(null===(a=window.chatHistory[n.activegroup.groupName])||void 0===a?void 0:a.chatList.map(((e,t)=>{let a=e.time.split("T");return(0,v.jsxs)("div",{className:"my-4",children:[(0,v.jsxs)("p",{className:"text-[9px] text-gray-600",children:[a[0]," / ",a[1].substring(0,8)," ",e.author]}),(0,v.jsxs)("div",{className:"py-2 px-4 mx-1 rounded-sm shadow-edge bg-white w-fit max-w-[50%] text-sm",children:[e.message,t+1==window.chatHistory[n.activegroup.groupName].chatList.length?(0,v.jsx)("div",{id:"end"}):""]})]},e.message)})))]}),(0,v.jsxs)("div",{className:" flex h-fit",children:[(0,v.jsx)("input",{value:n.message,onChange:e=>{e.preventDefault(),c({...n,message:e.target.value})},className:" border-oxford_blue p-1 rounded-xl border h-10 w-[100%]",type:"text"}),(0,v.jsx)("div",{onClick:e=>{e.preventDefault(),console.log(n.message,n.userName),n.Socket&&n.userName&&n.activegroup&&n.groupsJoined.filter((e=>e.groupName===n.activegroup.groupName)).length?(n.Socket.emit("chat message",{author:n.userName,message:n.message,groupName:n.activegroup.groupName}),c({...n,message:""})):(c({...n,alertMsg:"join group before sending message",alertType:"warning"}),u.Ay.error("you've not joined this group"))},children:(0,v.jsx)("img",{src:r.A,className:"",width:"40px",alt:"send icon"})})]})]}):(0,v.jsxs)("div",{className:"",children:[(0,v.jsx)("div",{className:"p-1 ",children:"Lounge"}),(0,v.jsx)("div",{className:"text-gray-600 text-xs flex justify-center",children:(0,v.jsx)("p",{children:"Available Groups"})}),(0,v.jsx)("div",{className:"Grpcontainer min-h-[80vh]",children:null===w||void 0===w?void 0:w.map(((e,t)=>(0,v.jsxs)("div",{onClick:()=>{c((e=>(k(),{...e,activegroup:{...w[t]}})))},className:"w-full bg-gradient-to-r from-[#FFF5DA] rounded-md p-2 my-2 to-white shadow-tile flex hover:scale-105 cursor-pointer",children:[(0,v.jsx)("div",{className:"w-8 h-8 rounded-full p-2 bg-white flex justify-center items-center",children:(0,v.jsx)("img",{className:"rounded-full",src:o.A,alt:"user"})}),(0,v.jsxs)("div",{className:"mx-2 w-[80%] flex items-center",children:[(0,v.jsx)("div",{className:"font-light text-sm w-1/2",children:e.groupName}),(0,v.jsxs)("div",{className:"w-1/2 border-l p-1 border-[#E9BB19] text-[8px]",children:[e.description.substring(0,20)," ..."]}),window.chatHistory&&window.chatHistory[e.groupName]&&window.chatHistory[e.groupName].unreadCount?(0,v.jsx)("div",{className:"py-1 px-2 float-right text-white font-black text-xs bg-amber-400 rounded",children:window.chatHistory[e.groupName].unreadCount}):""]})]},e.groupName)))}),(0,v.jsxs)("div",{onClick:e=>{e.preventDefault(),u.Ay.loading("Upcoming feature, will be availablel soon",{duration:2500})},className:"px-4 mx-auto py-2 rounded-full w-fit flex shadow-edge bg-[#8ef57e] text-xs",children:[(0,v.jsx)("img",{src:h.A,alt:"add group",width:"20px"}),(0,v.jsx)("button",{className:"mx-1",children:"Add Group"})]})]})})]})}}}]);