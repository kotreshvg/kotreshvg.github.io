"use strict";(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[711],{6446:function(e,n,t){t.d(n,{s:function(){return d},z:function(){return l}});var s=t(4165),r=t(5861),i=t(3144),o=t(5671),c=t(8635),a=t(9864),u=t(942),d=(0,i.Z)((function e(){var n=this;if((0,o.Z)(this,e),this._instance=null,this.server=(0,c.io)(window.config.BACKEND_URL,{autoConnect:!1}),this._initEvents=function(){n.server.on("connect",(function(e){a.Z.dispatch((0,u.E$)())})),n.server.on("disconnect",(function(){a.Z.dispatch((0,u.cH)())})),n.server.on("matchFound",(function(e){window.sessionStorage.setItem("recepientName",e.name),window.sessionStorage.setItem("recepientGender",e.gender),a.Z.dispatch((0,u.rh)({recepientId:e.recepientId,call:e.call||!1}))})),n.server.on("MatchRevoked",(function(e){window.sessionStorage.removeItem("recepientName"),window.sessionStorage.removeItem("recepientGender"),a.Z.dispatch((0,u.c4)())}))},this.connect=function(){n._initEvents(),n._instance=n.server.connect()},this.disconnect=function(){n._instance&&n._instance.Connected&&n.server.disconnect()},this.getSocket=(0,r.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n._instance||!n._instance.Connected){e.next=4;break}return e.abrupt("return",n._instance);case 4:return n.connect(),e.abrupt("return",n._instance);case 6:case"end":return e.stop()}}),e)}))),e._instance)return e._socInstance;e._socInstance=this})),l=(0,i.Z)((function e(){var n=this;if((0,o.Z)(this,e),this._instance=null,this.server=(0,c.io)(window.config.BACKEND_URL,{autoConnect:!0,path:"/groupservice/socket.io"}),this._initEvents=function(){n.server.on("connect",(function(e){a.Z.dispatch((0,u.E$)())})),n.server.on("disconnect",(function(){a.Z.dispatch((0,u.cH)())})),n.server.on("matchFound",(function(e){window.sessionStorage.setItem("recepientName",e.name),window.sessionStorage.setItem("recepientGender",e.gender),a.Z.dispatch((0,u.rh)({recepientId:e.recepientId,call:e.call||!1}))})),n.server.on("MatchRevoked",(function(e){window.sessionStorage.removeItem("recepientName"),window.sessionStorage.removeItem("recepientGender"),a.Z.dispatch((0,u.c4)())}))},this.connect=function(){n._initEvents(),n._instance=n.server.connect()},this.disconnect=function(){n._instance&&n._instance.Connected&&n.server.disconnect()},this.getSocket=(0,r.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n._instance||!n._instance.Connected){e.next=4;break}return e.abrupt("return",n._instance);case 4:return n.connect(),e.abrupt("return",n._instance);case 6:case"end":return e.stop()}}),e)}))),e._instance)return e._socInstance;e._socInstance=this}))},6711:function(e,n,t){t.r(n),t.d(n,{default:function(){return v}});var s=t(4942),r=t(3433),i=t(1413),o=t(9439),c=t(7313),a=t(5034),u=t(5170),d=t(4857),l=t(6446),p=t(4165),m=t(5861),f=t(6573).Z.create({baseURL:window.config.BACKEND_URL+"/groupservice"}),h=function(){var e=(0,m.Z)((0,p.Z)().mark((function e(){return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",f.get("/Getgroups"));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),g=t(6417),v=function(e){var n,t,p=(0,c.useState)({alertMsg:void 0,alertType:void 0,redirect:void 0,Socket:void 0,activegroup:void 0,groupExpanded:void 0,chatMenuVisible:!1,groupsJoined:[],message:""}),m=(0,o.Z)(p,2),f=m[0],v=m[1],x=(0,c.useState)([{groupName:"movies",description:"group about movies, reviews, critics and follows",createdDate:new Date}]),w=(0,o.Z)(x,2),N=w[0],Z=(w[1],(0,c.useReducer)((function(e){return e+1}),0)),j=(0,o.Z)(Z,2),b=(j[0],j[1]);(0,c.useEffect)((function(){return h().then((function(e){})),(new l.z).getSocket().then((function(e){v((0,i.Z)((0,i.Z)({},f),{},{Socket:e})),e.on("group joined",(function(e){v((function(n){return(0,i.Z)((0,i.Z)({},n),{},{groupsJoined:[].concat((0,r.Z)(n.groupsJoined),(0,r.Z)(N.filter((function(n){return n.groupName===e.groupName}))))})}))})),e.on("chat message",(function(e){e=JSON.parse(e),console.log(e,e.groupName),window.chatHistory[e.groupName].push(e),b()})),e.on("message history",(function(e){console.log(e);var n=window.chatHistory;if(n){console.log(n);var t=n[e.groupName]?(0,r.Z)(n[e.groupName]):[];window.chatHistory=(0,i.Z)((0,i.Z)({},window.chatHistory),{},(0,s.Z)({},e.groupName,[].concat((0,r.Z)(t),(0,r.Z)(e.messages.map((function(e){return JSON.parse(e)}))))))}else window.chatHistory=(0,s.Z)({},e.groupName,(0,r.Z)(e.messages.map((function(e){return JSON.parse(e)}))));b()}))})),function(){f.Socket&&f.Socket.disconnect()}}),[]);var _=function(e){e.preventDefault(),f.Socket&&f.Socket.emit("joinRequest",{groupName:f.activegroup.groupName})};return(0,g.jsxs)("div",{className:"w-full flex",children:[(0,g.jsxs)("div",{className:"w-1/4 p-4 min-h-[90vh] bg-gradient-to-r from-[#FFFAED] to-white border-r border-[#E9BB19]",children:[(0,g.jsx)("div",{className:"text-gray-600 text-[10px] mb-1 flex justify-center",children:(0,g.jsx)("p",{children:"Available Groups"})}),(0,g.jsx)("div",{className:"Grpcontainer",children:null===N||void 0===N?void 0:N.map((function(e,n){return(0,g.jsxs)("div",{onMouseEnter:function(){setTimeout((function(){v((0,i.Z)((0,i.Z)({},f),{},{groupExpanded:(0,i.Z)({},N[n])}))}),500)},onClick:function(){v((0,i.Z)((0,i.Z)({},f),{},{activegroup:(0,i.Z)({},N[n])}))},onMouseLeave:function(){setTimeout((function(){v((0,i.Z)((0,i.Z)({},f),{},{groupExpanded:void 0}))}),500)},className:"w-full bg-gradient-to-r from-[#FFF5DA] rounded-md p-2 my-2 to-white shadow-tile flex hover:scale-105 cursor-pointer",children:[(0,g.jsx)("div",{className:"w-8 h-8 rounded-full p-2 bg-white flex justify-center items-center",children:(0,g.jsx)("img",{className:"rounded-full",src:a.Z,alt:"user"})}),(0,g.jsxs)("div",{className:"mx-2 w-[80%] flex items-center",children:[(0,g.jsx)("div",{className:"font-light text-sm w-1/2",children:e.groupName}),(0,g.jsxs)("div",{className:"w-1/2 border-l p-1 border-[#E9BB19] text-[8px]",children:[e.description.substring(0,20)," ..."]})]})]},e.groupName)}))})]}),(0,g.jsxs)("div",{className:"w-3/4 min-h-[90vh] p-2 relative",children:[f.groupExpanded?(0,g.jsxs)("div",{className:"absolute z-10 w-[30%] shadow-tile left-0 bg-white p-4 rounded-md",children:[(0,g.jsxs)("div",{className:"flex flex-col items-center",children:[(0,g.jsx)("img",{className:"m-2 rounded-full border border-[#fff3d7] p-2",src:a.Z,alt:"user icon"}),(0,g.jsx)("p",{children:f.groupExpanded.groupName})]}),(0,g.jsxs)("div",{className:"my-2",children:[(0,g.jsx)("label",{className:"text-sm",children:"Description :"}),(0,g.jsx)("p",{className:"text-xs",children:f.groupExpanded.description})]}),(0,g.jsxs)("div",{className:"my-2",children:[(0,g.jsx)("label",{className:"text-sm",children:"Created Date :"}),(0,g.jsx)("p",{className:"text-xs"})]}),(0,g.jsx)("div",{children:(0,g.jsx)("button",{onClick:_,className:"bg-[#8ef57e] text-sm rounded-full px-2 py-1 text-dark_grey hover:scale-105 hover:text-black",children:"Join Group"})})]}):"",(0,g.jsxs)("div",{className:"w-full min-h-full p-2 bg-gradient-to-r from-[#FFFAED] to-white shadow-panel rounded",children:[(0,g.jsxs)("div",{className:"flex h-fit p-2 justify-between items-center w-full  bg-[#FFF7E1] rounded shadow-edge",children:[(0,g.jsx)("div",{className:"w-8 h-8 rounded-full p-2 bg-white flex justify-center items-center",children:(0,g.jsx)("img",{className:"rounded-full",src:a.Z,alt:"user"})}),(0,g.jsx)("h4",{className:"text-sm",children:null===(n=f.activegroup)||void 0===n?void 0:n.groupName}),(0,g.jsxs)("div",{className:"flex",children:[f.activegroup&&!f.groupsJoined.filter((function(e){return e.groupName===f.activegroup.groupName})).length?(0,g.jsx)("button",{onClick:_,className:"py-1 px-4 hover:scale-105 text-dark_grey hover:text-black bg-[#8ef57e] rounded-full text-sm",children:"Join"}):"",(0,g.jsx)("img",{className:"hover:bg-[#f8f1df] rounded-full px-1",src:d.Z,alt:"menu"})]})]}),(0,g.jsx)("div",{className:"w-full h-[75vh] overflow-auto scroll-none scroll-hide py-2",children:window.chatHistory&&f.activegroup&&(null===(t=window.chatHistory[f.activegroup.groupName])||void 0===t?void 0:t.map((function(e){var n=e.time.split("T");return(0,g.jsxs)("div",{className:"py-2 px-4 rounded-sm shadow-edge my-4 bg-white w-fit max-w-[50%] text-sm",children:[(0,g.jsxs)("p",{className:"text-[9px] text-gray-600",children:[n[0]," / ",n[1].substring(0,8)]}),e.message]},e.message)})))}),(0,g.jsxs)("div",{className:"w-full h-10 rounded p-1 flex",children:[(0,g.jsx)("input",{type:"text",value:f.message,onChange:function(e){v((0,i.Z)((0,i.Z)({},f),{},{message:e.target.value}))},className:"h-full rounded w-[95%] border border-violet-600 outline-none p-2",placeholder:"Type Here ..."}),(0,g.jsx)("div",{onClick:function(e){e.preventDefault(),console.log(f.message),f.Socket&&f.activegroup&&f.groupsJoined.filter((function(e){return e.groupName===f.activegroup.groupName})).length?(f.Socket.emit("chat message",{name:"userName",message:f.message,groupName:f.activegroup.groupName}),v((0,i.Z)((0,i.Z)({},f),{},{message:""}))):v((0,i.Z)((0,i.Z)({},f),{},{alertMsg:"join group before sending message",alertType:"warning"}))},className:"p-2 flex items-center hover:scale-110",children:(0,g.jsx)("img",{src:u.Z,alt:"send icon"})})]})]})]})]})}}}]);