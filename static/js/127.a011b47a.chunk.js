"use strict";(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[127],{5127:(e,s,a)=>{a.r(s),a.d(s,{default:()=>N});var t=a(9950),r=a(9881),o=a(6033),i=a(897),l=a(4577),n=a(346),d=a(5009),c=a(4806),u=a.n(c),m=a(1182),p=a(5887),g=(a(8341),a(6039)),h=a(9749),x=a(4414);const v=e=>{const[s,a]=(0,t.useState)({name:"",age:""});return(0,x.jsxs)(u(),{isOpen:e.isOpen,shouldCloseOnOverlayClick:!0,style:{content:{top:"50%",left:"50%",right:"auto",width:"30%",height:"40%",bottom:"auto",transform:"translate(-50%, -50%)",backgroundColor:"#FFFAED"},overlay:{backgroundColor:"#595959"}},children:[(0,x.jsx)("p",{className:"text-sm mb-4",children:"Below Fields are required for using group chat"}),(0,x.jsxs)("div",{className:"flex",children:[(0,x.jsx)("p",{className:"mx-2 w-1/2 text-sm",children:"Name"}),(0,x.jsx)("input",{placeholder:"John Doe",className:"rounded text-sm px-2 py-1 outline-none border border-amber-200",type:"text",maxLength:10,value:s.name,onChange:e=>{a({...s,name:e.target.value,age:0})}})]}),(0,x.jsxs)("div",{className:"flex mt-2",children:[(0,x.jsx)("p",{className:"mx-2 w-1/2 text-sm",children:"Age"}),(0,x.jsx)("input",{placeholder:"20",className:"rounded text-sm px-2 py-1 outline-none border border-amber-200",type:"number",value:s.age,onChange:e=>{a({...s,age:e.target.value})}})]}),(0,x.jsx)("button",{onClick:a=>{a.preventDefault(),m.a.extractUserName(s.name)&&parseInt(s.age)>0&&e.save(m.a.extractUserName(s.name),parseInt(s.age))},className:"bg-[#8ef57e] py-2 float-right mt-4 px-4 rounded-full text-sm shadow-edge",children:"Continue"})]})},N=e=>{var s,a;const[c,u]=(0,t.useState)({alertMsg:void 0,alertType:void 0,redirect:void 0,Socket:void 0,activegroup:void 0,groupExpanded:void 0,chatMenuVisible:!1,groupsJoined:[],message:"",userName:h.A.getState().authentication.userName||localStorage.getItem("userName")||""}),[m,N]=(0,t.useState)(!1),[f,w]=(0,t.useState)([]),[j,b]=(0,t.useReducer)((e=>e+1),0);(0,t.useEffect)((()=>{setTimeout((()=>{N(!0)}),2e3)}),[]),(0,t.useEffect)((()=>{window.chatHistory&&window.chatHistory[c.activegroup.groupName]&&(window.chatHistory[c.activegroup.groupName].unreadCount=0)}),[c.activegroup]),(0,t.useEffect)((()=>((0,d.V)().then((e=>{let s=[...e.data.Groups.map((e=>{let s=JSON.parse(e);return s.time=new Date(s.time),s}))];u((e=>(w(s),{...e,availableGroups:s})))})),(new n.D).getSocket().then((e=>{u({...c,Socket:e}),e.on("group joined",(e=>{console.log("joined"),p.Ay.success("joined ".concat(e.groupName)),u((s=>({...s,groupsJoined:[...s.groupsJoined,...s.availableGroups.filter((s=>s.groupName===e.groupName))]})))})),e.on("chat message",(e=>{e=JSON.parse(e),window.chatHistory[e.groupName].chatList.push(e),u((s=>(s.activegroup&&e.groupName!==s.activegroup.groupName&&(window.chatHistory[e.groupName].unreadCount++,(0,p.Ay)("received msg ".concat(e.groupName),{icon:(0,x.jsx)("img",{src:i.A,width:"20px",className:"rounded-full"}),style:{background:"#FFE900",borderRadius:"10px"}})),s))),b(),y()})),e.on("message history",(e=>{console.log(e);let s=window.chatHistory;if(s){console.log(s);let a=s[e.groupName]?[...s[e.groupName]]:[];window.chatHistory={...window.chatHistory,[e.groupName]:{unreadCount:0,chatList:[...a,...e.messages.map((e=>JSON.parse(e)))]}}}else window.chatHistory={[e.groupName]:{unreadCount:0,chatList:[...e.messages.map((e=>JSON.parse(e)))]}};b(),y()}))})),()=>{c.Socket&&c.Socket.disconnect()})),[]);const y=()=>{setTimeout((e=>{var s;null===(s=document.getElementById("end"))||void 0===s||s.scrollIntoView({behavior:"smooth",block:"nearest"})}),100)},k=e=>{e.preventDefault(),c.Socket&&c.userName&&c.activegroup&&c.groupsJoined.filter((e=>e.groupName===c.activegroup.groupName)).length?(c.Socket.emit("chat message",{author:c.userName,message:c.message,groupName:c.activegroup.groupName}),u({...c,message:""})):(u({...c,alertMsg:"join group before sending message",alertType:"warning"}),p.Ay.error("you've not joined any group"))},C=e=>{e.preventDefault(),c.Socket&&c.Socket.emit("joinRequest",{groupName:c.activegroup.groupName})};return(0,x.jsxs)("div",{className:"w-full flex",children:[(0,x.jsx)(p.l$,{}),""===c.userName&&(0,x.jsx)(v,{isOpen:m,save:(e,s)=>{u({...c,userName:e,age:s}),N(!1)}}),(0,x.jsxs)("div",{className:"w-1/4 p-4 min-h-[90vh] bg-gradient-to-r from-[#FFFAED] to-white border-r border-[#E9BB19]",children:[(0,x.jsx)("div",{className:"text-gray-600 text-[10px] mb-1 flex justify-center",children:(0,x.jsx)("p",{children:"Available Groups"})}),(0,x.jsx)("div",{className:"Grpcontainer min-h-[85%]",children:null===f||void 0===f?void 0:f.map(((e,s)=>(0,x.jsxs)("div",{onMouseEnter:()=>{setTimeout((()=>{u((e=>({...e,groupExpanded:{...f[s]}})))}),1e3)},onClick:()=>{u((e=>({...e,activegroup:{...f[s]}})))},onMouseLeave:()=>{setTimeout((()=>{u((e=>({...e,groupExpanded:void 0})))}),1e3)},className:"w-full bg-gradient-to-r from-[#FFF5DA] rounded-md p-2 my-2 to-white shadow-tile flex hover:scale-105 cursor-pointer",children:[(0,x.jsx)("div",{className:"w-8 h-8 rounded-full p-2 bg-white flex justify-center items-center",children:(0,x.jsx)("img",{className:"rounded-full",src:r.A,alt:"user"})}),(0,x.jsxs)("div",{className:"mx-2 w-[80%] flex items-center",children:[(0,x.jsx)("div",{className:"font-light text-sm w-1/2",children:e.groupName}),(0,x.jsxs)("div",{className:"w-1/2 border-l p-1 border-[#E9BB19] text-[8px]",children:[e.description.substring(0,20)," ..."]}),window.chatHistory&&window.chatHistory[e.groupName]&&window.chatHistory[e.groupName].unreadCount?(0,x.jsx)("div",{className:"py-1 px-2 float-right text-white font-black text-xs bg-amber-400 rounded",children:window.chatHistory[e.groupName].unreadCount}):""]})]},e.groupName)))}),(0,x.jsxs)("div",{onClick:e=>{e.preventDefault(),p.Ay.loading("Upcoming feature, will be availablel soon",{duration:2500})},className:"px-4 mx-auto py-2 rounded-full w-fit flex shadow-edge bg-[#8ef57e] text-xs",children:[(0,x.jsx)("img",{src:g.A,alt:"add group",width:"20px"}),(0,x.jsx)("button",{className:"mx-1",children:"Add Group"})]})]}),(0,x.jsxs)("div",{className:"w-3/4 min-h-[90vh] p-2 relative",children:[c.groupExpanded?(0,x.jsxs)("div",{className:"absolute z-10 w-[30%] shadow-tile left-0 bg-white p-4 rounded-md",children:[(0,x.jsxs)("div",{className:"flex flex-col items-center",children:[(0,x.jsx)("img",{className:"m-2 rounded-full border border-[#fff3d7] p-2",src:r.A,alt:"user icon"}),(0,x.jsx)("p",{children:c.groupExpanded.groupName})]}),(0,x.jsxs)("div",{className:"my-2",children:[(0,x.jsx)("label",{className:"text-sm",children:"Description :"}),(0,x.jsx)("p",{className:"text-xs",children:c.groupExpanded.description})]}),(0,x.jsxs)("div",{className:"my-2",children:[(0,x.jsx)("label",{className:"text-sm",children:"Created Date :"}),(0,x.jsxs)("p",{className:"text-xs",children:[c.groupExpanded.time.toLocaleDateString()," (D / M / Y)"]})]}),(0,x.jsx)("div",{children:(0,x.jsx)("button",{onClick:C,className:"bg-[#8ef57e] text-sm rounded-full px-2 py-1 text-dark_grey hover:scale-105 hover:text-black",children:"Join Group"})})]}):"",(0,x.jsxs)("div",{className:"w-full min-h-full p-2 bg-gradient-to-r from-[#FFFAED] to-white shadow-panel rounded",children:[(0,x.jsxs)("div",{className:"flex h-fit p-2 justify-between items-center w-full  bg-[#FFF7E1] rounded shadow-edge",children:[(0,x.jsx)("div",{className:"w-8 h-8 rounded-full p-2 bg-white flex justify-center items-center",children:(0,x.jsx)("img",{className:"rounded-full",src:r.A,alt:"user"})}),(0,x.jsx)("h4",{className:"text-sm",children:null===(s=c.activegroup)||void 0===s?void 0:s.groupName}),(0,x.jsxs)("div",{className:"flex",children:[c.activegroup&&!c.groupsJoined.filter((e=>e.groupName===c.activegroup.groupName)).length?(0,x.jsx)("button",{onClick:C,className:"py-1 px-4 hover:scale-105 text-dark_grey hover:text-black bg-[#8ef57e] rounded-full text-sm",children:"Join"}):"",(0,x.jsx)("img",{className:"hover:bg-[#f8f1df] rounded-full px-1",src:l.A,alt:"menu"})]})]}),(0,x.jsx)("div",{className:"w-full h-[75vh] overflow-auto scroll-none scroll-hide py-2",children:window.chatHistory&&c.activegroup&&(null===(a=window.chatHistory[c.activegroup.groupName])||void 0===a?void 0:a.chatList.map(((e,s)=>{let a=e.time.split("T");return(0,x.jsxs)("div",{className:"my-4",children:[(0,x.jsxs)("p",{className:"text-[9px] text-gray-600",children:[a[0]," / ",a[1].substring(0,8)," ",e.author]}),(0,x.jsxs)("div",{className:"py-2 px-4 mx-1 rounded-sm shadow-edge bg-white w-fit max-w-[50%] text-sm",children:[e.message,s+1==window.chatHistory[c.activegroup.groupName].chatList.length?(0,x.jsx)("div",{id:"end"}):""]})]},e.message)})))}),(0,x.jsxs)("div",{className:"w-full h-10 rounded p-1 flex",children:[(0,x.jsx)("input",{onKeyDown:e=>{"Enter"===e.code&&k(e)},type:"text",value:c.message,onChange:e=>{u({...c,message:e.target.value})},className:"h-full rounded w-[95%] border border-violet-600 outline-none p-2",placeholder:"Type Here ..."}),(0,x.jsx)("div",{onClick:k,className:"p-2 flex items-center hover:scale-110",children:(0,x.jsx)("img",{src:o.A,alt:"send icon"})})]})]})]})]})}}}]);