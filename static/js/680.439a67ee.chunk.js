"use strict";(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[680],{5651:function(e,n,t){t(7313);n.Z=t.p+"static/media/Bell.215cecd8a15a46054068bec8989c86bb.svg"},5161:function(e,n,t){t(7313);n.Z=t.p+"static/media/add.c32009a4fb2366d5371060e23b3e3c36.svg"},3921:function(e,n,t){t.d(n,{t:function(){return i}});var r=t(4165),s=t(5861),o=t(6573).Z.create({baseURL:window.config.BACKEND_URL+"/groupservice"}),i=function(){var e=(0,s.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o.get("/Getgroups"));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},6446:function(e,n,t){t.d(n,{s:function(){return d},z:function(){return l}});var r=t(4165),s=t(5861),o=t(3144),i=t(5671),a=t(8635),c=t(9864),u=t(942),d=(0,o.Z)((function e(){var n=this;if((0,i.Z)(this,e),this._instance=null,this.server=(0,a.io)(window.config.BACKEND_URL,{autoConnect:!1}),this._initEvents=function(){n.server.on("connect",(function(e){c.Z.dispatch((0,u.E$)())})),n.server.on("disconnect",(function(){c.Z.dispatch((0,u.cH)())})),n.server.on("matchFound",(function(e){window.sessionStorage.setItem("recepientName",e.name),window.sessionStorage.setItem("recepientGender",e.gender),c.Z.dispatch((0,u.rh)({recepientId:e.recepientId,call:e.call||!1}))})),n.server.on("MatchRevoked",(function(e){window.sessionStorage.removeItem("recepientName"),window.sessionStorage.removeItem("recepientGender"),c.Z.dispatch((0,u.c4)())}))},this.connect=function(){n._initEvents(),n._instance=n.server.connect()},this.disconnect=function(){n._instance&&n._instance.Connected&&n.server.disconnect()},this.getSocket=(0,s.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n._instance||!n._instance.Connected){e.next=4;break}return e.abrupt("return",n._instance);case 4:return n.connect(),e.abrupt("return",n._instance);case 6:case"end":return e.stop()}}),e)}))),e._instance)return e._socInstance;e._socInstance=this})),l=(0,o.Z)((function e(){var n=this;if((0,i.Z)(this,e),this._instance=null,this.server=(0,a.io)(window.config.BACKEND_URL,{autoConnect:!0,path:"/groupservice/socket.io"}),this._initEvents=function(){n.server.on("connect",(function(e){c.Z.dispatch((0,u.E$)())})),n.server.on("disconnect",(function(){c.Z.dispatch((0,u.cH)())})),n.server.on("matchFound",(function(e){window.sessionStorage.setItem("recepientName",e.name),window.sessionStorage.setItem("recepientGender",e.gender),c.Z.dispatch((0,u.rh)({recepientId:e.recepientId,call:e.call||!1}))})),n.server.on("MatchRevoked",(function(e){window.sessionStorage.removeItem("recepientName"),window.sessionStorage.removeItem("recepientGender"),c.Z.dispatch((0,u.c4)())}))},this.connect=function(){n._initEvents(),n._instance=n.server.connect()},this.disconnect=function(){n._instance&&n._instance.Connected&&n.server.disconnect()},this.getSocket=(0,s.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n._instance||!n._instance.Connected){e.next=4;break}return e.abrupt("return",n._instance);case 4:return n.connect(),e.abrupt("return",n._instance);case 6:case"end":return e.stop()}}),e)}))),e._instance)return e._socInstance;e._socInstance=this}))},9680:function(e,n,t){t.r(n);var r=t(4942),s=t(1413),o=t(3433),i=t(9439),a=t(7313),c=t(5034),u=t(5170),d=t(5651),l=t(4857),m=t(6446),p=t(3921),g=t(9284),h=t.n(g),f=t(3262),x=t(6056),v=(t(3392),t(5161)),w=t(6417),N=function(e){var n=(0,a.useState)({name:"",age:""}),t=(0,i.Z)(n,2),r=t[0],o=t[1];return(0,w.jsxs)(h(),{isOpen:e.isOpen,shouldCloseOnOverlayClick:!0,style:{content:{top:"50%",left:"50%",right:"auto",width:"30%",height:"40%",bottom:"auto",transform:"translate(-50%, -50%)",backgroundColor:"#FFFAED"},overlay:{backgroundColor:"#595959"}},children:[(0,w.jsx)("p",{className:"text-sm mb-4",children:"Below Fields are required for using group chat"}),(0,w.jsxs)("div",{className:"flex",children:[(0,w.jsx)("p",{className:"mx-2 w-1/2 text-sm",children:"Name"}),(0,w.jsx)("input",{placeholder:"John Doe",className:"rounded text-sm px-2 py-1 outline-none border border-amber-200",type:"text",maxLength:10,value:r.name,onChange:function(e){o((0,s.Z)((0,s.Z)({},r),{},{name:e.target.value,age:0}))}})]}),(0,w.jsxs)("div",{className:"flex mt-2",children:[(0,w.jsx)("p",{className:"mx-2 w-1/2 text-sm",children:"Age"}),(0,w.jsx)("input",{placeholder:"20",className:"rounded text-sm px-2 py-1 outline-none border border-amber-200",type:"number",value:r.age,onChange:function(e){o((0,s.Z)((0,s.Z)({},r),{},{age:e.target.value}))}})]}),(0,w.jsx)("button",{onClick:function(n){n.preventDefault(),f.N.extractUserName(r.name)&&parseInt(r.age)>0&&e.save(f.N.extractUserName(r.name),parseInt(r.age))},className:"bg-[#8ef57e] py-2 float-right mt-4 px-4 rounded-full text-sm shadow-edge",children:"Continue"})]})};n.default=function(e){var n,t,g=(0,a.useState)({alertMsg:void 0,alertType:void 0,redirect:void 0,Socket:void 0,activegroup:void 0,groupExpanded:void 0,chatMenuVisible:!1,groupsJoined:[],message:"",userName:"stranger"}),h=(0,i.Z)(g,2),f=h[0],Z=h[1],b=(0,a.useState)(!1),j=(0,i.Z)(b,2),y=j[0],k=j[1],_=(0,a.useState)([]),C=(0,i.Z)(_,2),E=C[0],S=C[1],F=(0,a.useReducer)((function(e){return e+1}),0),I=(0,i.Z)(F,2),H=(I[0],I[1]);(0,a.useEffect)((function(){setTimeout((function(){k(!0)}),2e3)}),[]),(0,a.useEffect)((function(){window.chatHistory&&window.chatHistory[f.activegroup.groupName]&&(window.chatHistory[f.activegroup.groupName].unreadCount=0)}),[f.activegroup]),(0,a.useEffect)((function(){return(0,p.t)().then((function(e){var n=(0,o.Z)(e.data.Groups.map((function(e){var n=JSON.parse(e);return n.time=new Date(n.time),n})));Z((function(e){return S(n),(0,s.Z)((0,s.Z)({},e),{},{availableGroups:n})}))})),(new m.z).getSocket().then((function(e){Z((0,s.Z)((0,s.Z)({},f),{},{Socket:e})),e.on("group joined",(function(e){console.log("joined"),x.ZP.success("joined ".concat(e.groupName)),Z((function(n){return(0,s.Z)((0,s.Z)({},n),{},{groupsJoined:[].concat((0,o.Z)(n.groupsJoined),(0,o.Z)(n.availableGroups.filter((function(n){return n.groupName===e.groupName}))))})}))})),e.on("chat message",(function(e){e=JSON.parse(e),window.chatHistory[e.groupName].chatList.push(e),Z((function(n){return n.activegroup&&e.groupName!==n.activegroup.groupName&&(window.chatHistory[e.groupName].unreadCount++,(0,x.ZP)("received msg ".concat(e.groupName),{icon:(0,w.jsx)("img",{src:d.Z,width:"20px",className:"rounded-full"}),style:{background:"#FFE900",borderRadius:"10px"}})),n})),H(),D()})),e.on("message history",(function(e){console.log(e);var n=window.chatHistory;if(n){console.log(n);var t=n[e.groupName]?(0,o.Z)(n[e.groupName]):[];window.chatHistory=(0,s.Z)((0,s.Z)({},window.chatHistory),{},(0,r.Z)({},e.groupName,{unreadCount:0,chatList:[].concat((0,o.Z)(t),(0,o.Z)(e.messages.map((function(e){return JSON.parse(e)}))))}))}else window.chatHistory=(0,r.Z)({},e.groupName,{unreadCount:0,chatList:(0,o.Z)(e.messages.map((function(e){return JSON.parse(e)})))});H(),D()}))})),function(){f.Socket&&f.Socket.disconnect()}}),[]);var D=function(){setTimeout((function(e){var n;null===(n=document.getElementById("end"))||void 0===n||n.scrollIntoView({behavior:"smooth",block:"nearest"})}),100)},G=function(e){e.preventDefault(),f.Socket&&f.userName&&f.activegroup&&f.groupsJoined.filter((function(e){return e.groupName===f.activegroup.groupName})).length?(f.Socket.emit("chat message",{author:f.userName,message:f.message,groupName:f.activegroup.groupName}),Z((0,s.Z)((0,s.Z)({},f),{},{message:""}))):(Z((0,s.Z)((0,s.Z)({},f),{},{alertMsg:"join group before sending message",alertType:"warning"})),x.ZP.error("you've not joined any group"))},J=function(e){e.preventDefault(),f.Socket&&f.Socket.emit("joinRequest",{groupName:f.activegroup.groupName})};return(0,w.jsxs)("div",{className:"w-full flex",children:[(0,w.jsx)(x.x7,{}),(0,w.jsx)(N,{isOpen:y,save:function(e,n){Z((0,s.Z)((0,s.Z)({},f),{},{userName:e,age:n})),k(!1)}}),(0,w.jsxs)("div",{className:"w-1/4 p-4 min-h-[90vh] bg-gradient-to-r from-[#FFFAED] to-white border-r border-[#E9BB19]",children:[(0,w.jsx)("div",{className:"text-gray-600 text-[10px] mb-1 flex justify-center",children:(0,w.jsx)("p",{children:"Available Groups"})}),(0,w.jsx)("div",{className:"Grpcontainer min-h-[85%]",children:null===E||void 0===E?void 0:E.map((function(e,n){return(0,w.jsxs)("div",{onMouseEnter:function(){setTimeout((function(){Z((function(e){return(0,s.Z)((0,s.Z)({},e),{},{groupExpanded:(0,s.Z)({},E[n])})}))}),1e3)},onClick:function(){Z((function(e){return(0,s.Z)((0,s.Z)({},e),{},{activegroup:(0,s.Z)({},E[n])})}))},onMouseLeave:function(){setTimeout((function(){Z((function(e){return(0,s.Z)((0,s.Z)({},e),{},{groupExpanded:void 0})}))}),1e3)},className:"w-full bg-gradient-to-r from-[#FFF5DA] rounded-md p-2 my-2 to-white shadow-tile flex hover:scale-105 cursor-pointer",children:[(0,w.jsx)("div",{className:"w-8 h-8 rounded-full p-2 bg-white flex justify-center items-center",children:(0,w.jsx)("img",{className:"rounded-full",src:c.Z,alt:"user"})}),(0,w.jsxs)("div",{className:"mx-2 w-[80%] flex items-center",children:[(0,w.jsx)("div",{className:"font-light text-sm w-1/2",children:e.groupName}),(0,w.jsxs)("div",{className:"w-1/2 border-l p-1 border-[#E9BB19] text-[8px]",children:[e.description.substring(0,20)," ..."]}),window.chatHistory&&window.chatHistory[e.groupName]&&window.chatHistory[e.groupName].unreadCount?(0,w.jsx)("div",{className:"py-1 px-2 float-right text-white font-black text-xs bg-amber-400 rounded",children:window.chatHistory[e.groupName].unreadCount}):""]})]},e.groupName)}))}),(0,w.jsxs)("div",{onClick:function(e){e.preventDefault(),x.ZP.loading("Upcoming feature, will be availablel soon",{duration:2500})},className:"px-4 mx-auto py-2 rounded-full w-fit flex shadow-edge bg-[#8ef57e] text-xs",children:[(0,w.jsx)("img",{src:v.Z,alt:"add group",width:"20px"}),(0,w.jsx)("button",{className:"mx-1",children:"Add Group"})]})]}),(0,w.jsxs)("div",{className:"w-3/4 min-h-[90vh] p-2 relative",children:[f.groupExpanded?(0,w.jsxs)("div",{className:"absolute z-10 w-[30%] shadow-tile left-0 bg-white p-4 rounded-md",children:[(0,w.jsxs)("div",{className:"flex flex-col items-center",children:[(0,w.jsx)("img",{className:"m-2 rounded-full border border-[#fff3d7] p-2",src:c.Z,alt:"user icon"}),(0,w.jsx)("p",{children:f.groupExpanded.groupName})]}),(0,w.jsxs)("div",{className:"my-2",children:[(0,w.jsx)("label",{className:"text-sm",children:"Description :"}),(0,w.jsx)("p",{className:"text-xs",children:f.groupExpanded.description})]}),(0,w.jsxs)("div",{className:"my-2",children:[(0,w.jsx)("label",{className:"text-sm",children:"Created Date :"}),(0,w.jsxs)("p",{className:"text-xs",children:[f.groupExpanded.time.toLocaleDateString()," (D / M / Y)"]})]}),(0,w.jsx)("div",{children:(0,w.jsx)("button",{onClick:J,className:"bg-[#8ef57e] text-sm rounded-full px-2 py-1 text-dark_grey hover:scale-105 hover:text-black",children:"Join Group"})})]}):"",(0,w.jsxs)("div",{className:"w-full min-h-full p-2 bg-gradient-to-r from-[#FFFAED] to-white shadow-panel rounded",children:[(0,w.jsxs)("div",{className:"flex h-fit p-2 justify-between items-center w-full  bg-[#FFF7E1] rounded shadow-edge",children:[(0,w.jsx)("div",{className:"w-8 h-8 rounded-full p-2 bg-white flex justify-center items-center",children:(0,w.jsx)("img",{className:"rounded-full",src:c.Z,alt:"user"})}),(0,w.jsx)("h4",{className:"text-sm",children:null===(n=f.activegroup)||void 0===n?void 0:n.groupName}),(0,w.jsxs)("div",{className:"flex",children:[f.activegroup&&!f.groupsJoined.filter((function(e){return e.groupName===f.activegroup.groupName})).length?(0,w.jsx)("button",{onClick:J,className:"py-1 px-4 hover:scale-105 text-dark_grey hover:text-black bg-[#8ef57e] rounded-full text-sm",children:"Join"}):"",(0,w.jsx)("img",{className:"hover:bg-[#f8f1df] rounded-full px-1",src:l.Z,alt:"menu"})]})]}),(0,w.jsx)("div",{className:"w-full h-[75vh] overflow-auto scroll-none scroll-hide py-2",children:window.chatHistory&&f.activegroup&&(null===(t=window.chatHistory[f.activegroup.groupName])||void 0===t?void 0:t.chatList.map((function(e,n){var t=e.time.split("T");return(0,w.jsxs)("div",{className:"my-4",children:[(0,w.jsxs)("p",{className:"text-[9px] text-gray-600",children:[t[0]," / ",t[1].substring(0,8)," ",e.author]}),(0,w.jsxs)("div",{className:"py-2 px-4 mx-1 rounded-sm shadow-edge bg-white w-fit max-w-[50%] text-sm",children:[e.message,n+1==window.chatHistory[f.activegroup.groupName].chatList.length?(0,w.jsx)("div",{id:"end"}):""]})]},e.message)})))}),(0,w.jsxs)("div",{className:"w-full h-10 rounded p-1 flex",children:[(0,w.jsx)("input",{onKeyDown:function(e){"Enter"===e.code&&G(e)},type:"text",value:f.message,onChange:function(e){Z((0,s.Z)((0,s.Z)({},f),{},{message:e.target.value}))},className:"h-full rounded w-[95%] border border-violet-600 outline-none p-2",placeholder:"Type Here ..."}),(0,w.jsx)("div",{onClick:G,className:"p-2 flex items-center hover:scale-110",children:(0,w.jsx)("img",{src:u.Z,alt:"send icon"})})]})]})]})]})}}}]);