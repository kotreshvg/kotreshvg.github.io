"use strict";(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[405],{5651:function(e,t,n){n(7313);t.Z=n.p+"static/media/Bell.215cecd8a15a46054068bec8989c86bb.svg"},5161:function(e,t,n){n(7313);t.Z=n.p+"static/media/add.c32009a4fb2366d5371060e23b3e3c36.svg"},3921:function(e,t,n){n.d(t,{t:function(){return i}});var r=n(4165),o=n(5861),s=n(6573).Z.create({baseURL:window.config.BACKEND_URL+"/groupservice"}),i=function(){var e=(0,o.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",s.get("/Getgroups"));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},6446:function(e,t,n){n.d(t,{s:function(){return d},z:function(){return l}});var r=n(4165),o=n(5861),s=n(3144),i=n(5671),a=n(8635),c=n(9864),u=n(942),d=(0,s.Z)((function e(){var t=this;if((0,i.Z)(this,e),this._instance=null,this.server=(0,a.io)(window.config.BACKEND_URL,{autoConnect:!1}),this._initEvents=function(){t.server.on("connect",(function(e){c.Z.dispatch((0,u.E$)())})),t.server.on("disconnect",(function(){c.Z.dispatch((0,u.cH)())})),t.server.on("matchFound",(function(e){window.sessionStorage.setItem("recepientName",e.name),window.sessionStorage.setItem("recepientGender",e.gender),c.Z.dispatch((0,u.rh)({recepientId:e.recepientId,call:e.call||!1}))})),t.server.on("MatchRevoked",(function(e){window.sessionStorage.removeItem("recepientName"),window.sessionStorage.removeItem("recepientGender"),c.Z.dispatch((0,u.c4)())}))},this.connect=function(){t._initEvents(),t._instance=t.server.connect()},this.disconnect=function(){t._instance&&t._instance.Connected&&t.server.disconnect()},this.getSocket=(0,o.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t._instance||!t._instance.Connected){e.next=4;break}return e.abrupt("return",t._instance);case 4:return t.connect(),e.abrupt("return",t._instance);case 6:case"end":return e.stop()}}),e)}))),e._instance)return e._socInstance;e._socInstance=this})),l=(0,s.Z)((function e(){var t=this;if((0,i.Z)(this,e),this._instance=null,this.server=(0,a.io)(window.config.BACKEND_URL,{autoConnect:!0,path:"/groupservice/socket.io"}),this._initEvents=function(){t.server.on("connect",(function(e){c.Z.dispatch((0,u.E$)())})),t.server.on("disconnect",(function(){c.Z.dispatch((0,u.cH)())})),t.server.on("matchFound",(function(e){window.sessionStorage.setItem("recepientName",e.name),window.sessionStorage.setItem("recepientGender",e.gender),c.Z.dispatch((0,u.rh)({recepientId:e.recepientId,call:e.call||!1}))})),t.server.on("MatchRevoked",(function(e){window.sessionStorage.removeItem("recepientName"),window.sessionStorage.removeItem("recepientGender"),c.Z.dispatch((0,u.c4)())}))},this.connect=function(){t._initEvents(),t._instance=t.server.connect()},this.disconnect=function(){t._instance&&t._instance.Connected&&t.server.disconnect()},this.getSocket=(0,o.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t._instance||!t._instance.Connected){e.next=4;break}return e.abrupt("return",t._instance);case 4:return t.connect(),e.abrupt("return",t._instance);case 6:case"end":return e.stop()}}),e)}))),e._instance)return e._socInstance;e._socInstance=this}))},9405:function(e,t,n){n.r(t),n.d(t,{default:function(){return b}});var r=n(4942),o=n(1413),s=n(3433),i=n(9439),a=n(7313),c=n(5034),u=n(5170),d=n(4857),l=n(3921),p=n(9284),m=n.n(p),g=n(3262),h=n(6056),f=n(6446),v=n(5651);var x=n.p+"static/media/arrow-left-solid.07f8c39113e8fb15b640ecafe6256813.svg",w=n(5161),N=n(6417),Z=function(e){var t=(0,a.useState)({name:"",age:""}),n=(0,i.Z)(t,2),r=n[0],s=n[1];return(0,N.jsxs)(m(),{isOpen:e.isOpen,shouldCloseOnOverlayClick:!0,style:{content:{top:"50%",left:"50%",right:"auto",width:"80%",height:"40%",bottom:"auto",transform:"translate(-50%, -50%)",backgroundColor:"#FFFAED"},overlay:{backgroundColor:"#595959"}},children:[(0,N.jsx)("p",{className:"text-sm mb-4",children:"Below Fields are required for using group chat"}),(0,N.jsxs)("div",{className:"flex",children:[(0,N.jsx)("p",{className:"mx-2 w-1/2 text-sm",children:"Name"}),(0,N.jsx)("input",{placeholder:"John Doe",className:"rounded text-sm px-2 py-1 outline-none border border-amber-200",type:"text",maxLength:10,value:r.name,onChange:function(e){s((0,o.Z)((0,o.Z)({},r),{},{name:e.target.value,age:0}))}})]}),(0,N.jsxs)("div",{className:"flex mt-2",children:[(0,N.jsx)("p",{className:"mx-2 w-1/2 text-sm",children:"Age"}),(0,N.jsx)("input",{placeholder:"20",className:"rounded text-sm px-2 py-1 outline-none border border-amber-200",type:"number",value:r.age,onChange:function(e){s((0,o.Z)((0,o.Z)({},r),{},{age:e.target.value}))}})]}),(0,N.jsx)("button",{onClick:function(t){t.preventDefault(),g.N.extractUserName(r.name)&&parseInt(r.age)>0&&e.save(g.N.extractUserName(r.name),parseInt(r.age))},className:"bg-[#8ef57e] py-2 float-right mt-4 px-4 rounded-full text-sm shadow-edge",children:"Continue"})]})},b=function(e){var t,n,p=(0,a.useState)({redirect:void 0,Socket:void 0,activegroup:void 0,groupExpanded:void 0,chatMenuVisible:!1,groupsJoined:[],message:"",userName:"stranger"}),m=(0,i.Z)(p,2),g=m[0],b=m[1],j=(0,a.useState)(!1),y=(0,i.Z)(j,2),k=y[0],_=y[1],C=(0,a.useState)([]),S=(0,i.Z)(C,2),E=S[0],F=S[1],I=(0,a.useReducer)((function(e){return e+1}),0),H=(0,i.Z)(I,2),D=(H[0],H[1]);(0,a.useEffect)((function(){setTimeout((function(){_(!0)}),2e3)}),[]);var G=function(){setTimeout((function(e){var t;null===(t=document.getElementById("end"))||void 0===t||t.scrollIntoView({behavior:"smooth",block:"nearest"})}),100)};(0,a.useEffect)((function(){return(0,l.t)().then((function(e){var t=(0,s.Z)(e.data.Groups.map((function(e){var t=JSON.parse(e);return t.time=new Date(t.time),t})));b((function(e){return F(t),(0,o.Z)((0,o.Z)({},e),{},{availableGroups:t})}))})),(new f.z).getSocket().then((function(e){b((0,o.Z)((0,o.Z)({},g),{},{Socket:e})),e.on("group joined",(function(e){console.log("joined"),h.ZP.success("joined ".concat(e.groupName)),b((function(t){return(0,o.Z)((0,o.Z)({},t),{},{groupsJoined:[].concat((0,s.Z)(t.groupsJoined),(0,s.Z)(t.availableGroups.filter((function(t){return t.groupName===e.groupName}))))})}))})),e.on("chat message",(function(e){e=JSON.parse(e),window.chatHistory[e.groupName].chatList.push(e),b((function(t){var n;return console.log(t.activegroup,e.groupName),void 0===t.activegroup|!(e.groupName===(null===(n=t.activegroup)||void 0===n?void 0:n.groupName))&&(window.chatHistory[e.groupName].unreadCount++,(0,h.ZP)("received msg ".concat(e.groupName),{icon:(0,N.jsx)("img",{src:v.Z,width:"20px",className:"rounded-full"}),style:{background:"#FFE900",borderRadius:"10px"}})),t})),D(),G()})),e.on("message history",(function(e){console.log(e);var t=window.chatHistory;if(t){console.log(t);var n=t[e.groupName]?(0,s.Z)(t[e.groupName]):[];window.chatHistory=(0,o.Z)((0,o.Z)({},window.chatHistory),{},(0,r.Z)({},e.groupName,{unreadCount:0,chatList:[].concat((0,s.Z)(n),(0,s.Z)(e.messages.map((function(e){return JSON.parse(e)}))))}))}else window.chatHistory=(0,r.Z)({},e.groupName,{unreadCount:0,chatList:(0,s.Z)(e.messages.map((function(e){return JSON.parse(e)})))});D(),G()}))})),function(){g.Socket&&g.Socket.disconnect()}}),[]),(0,a.useEffect)((function(){var e;window.chatHistory&&window.chatHistory[null===(e=g.activegroup)||void 0===e?void 0:e.groupName]&&(window.chatHistory[g.activegroup.groupName].unreadCount=0)}),[g.activegroup]);return(0,N.jsxs)(a.Fragment,{children:[(0,N.jsx)(h.x7,{}),(0,N.jsx)(Z,{isOpen:k,save:function(e,t){b((0,o.Z)((0,o.Z)({},g),{},{userName:e,age:t})),_(!1)}}),(0,N.jsx)("div",{className:"w-full p-2 min-h-[95vh] bg-gradient-to-r from-[#FFFAED] to-white border-r border-[#E9BB19]",children:g.activegroup?(0,N.jsxs)("div",{children:[(0,N.jsxs)("div",{className:"grid grid-cols-8 h-fit p-2 justify-between items-center w-full  bg-[#FFF7E1] rounded shadow-edge",children:[(0,N.jsx)("img",{onClick:function(e){e.preventDefault(),b((0,o.Z)((0,o.Z)({},g),{},{activegroup:void 0}))},className:"col-start-1",src:x,alt:"back icon",width:"16px"}),(0,N.jsx)("div",{className:"w-8 col-start-2 h-8 rounded-full p-2 bg-white flex justify-center items-center",children:(0,N.jsx)("img",{className:"rounded-full",src:c.Z,alt:"user"})}),(0,N.jsx)("h4",{className:"col-span-5 text-sm",children:null===(t=g.activegroup)||void 0===t?void 0:t.groupName}),(0,N.jsx)("img",{className:"hover:bg-[#f8f1df] col-span-1 rounded-full px-1",src:d.Z,alt:"menu"})]}),(0,N.jsxs)("div",{className:"h-[80vh] overflow-auto scroll-none scroll-hide bg-gradient-to-r from-[#FFFAED] to-white ",children:[g.activegroup&&!g.groupsJoined.filter((function(e){return e.groupName===g.activegroup.groupName})).length?(0,N.jsx)("div",{className:"w-full flex justify-center pt-2",children:(0,N.jsx)("button",{onClick:function(e){e.preventDefault(),g.Socket&&g.Socket.emit("joinRequest",{groupName:g.activegroup.groupName})},className:"py-1 px-4 hover:scale-105 text-dark_grey hover:text-black bg-[#8ef57e] rounded-full text-sm",children:"Join"})}):"",window.chatHistory&&g.activegroup&&(null===(n=window.chatHistory[g.activegroup.groupName])||void 0===n?void 0:n.chatList.map((function(e,t){var n=e.time.split("T");return(0,N.jsxs)("div",{className:"my-4",children:[(0,N.jsxs)("p",{className:"text-[9px] text-gray-600",children:[n[0]," / ",n[1].substring(0,8)," ",e.author]}),(0,N.jsxs)("div",{className:"py-2 px-4 mx-1 rounded-sm shadow-edge bg-white w-fit max-w-[50%] text-sm",children:[e.message,t+1==window.chatHistory[g.activegroup.groupName].chatList.length?(0,N.jsx)("div",{id:"end"}):""]})]},e.message)})))]}),(0,N.jsxs)("div",{className:" flex h-fit",children:[(0,N.jsx)("input",{value:g.message,onChange:function(e){e.preventDefault(),b((0,o.Z)((0,o.Z)({},g),{},{message:e.target.value}))},className:" border-oxford_blue p-1 rounded-xl border h-10 w-[100%]",type:"text"}),(0,N.jsx)("div",{onClick:function(e){e.preventDefault(),console.log(g.message,g.userName),g.Socket&&g.userName&&g.activegroup&&g.groupsJoined.filter((function(e){return e.groupName===g.activegroup.groupName})).length?(g.Socket.emit("chat message",{author:g.userName,message:g.message,groupName:g.activegroup.groupName}),b((0,o.Z)((0,o.Z)({},g),{},{message:""}))):(b((0,o.Z)((0,o.Z)({},g),{},{alertMsg:"join group before sending message",alertType:"warning"})),h.ZP.error("you've not joined this group"))},children:(0,N.jsx)("img",{src:u.Z,className:"",width:"40px",alt:"send icon"})})]})]}):(0,N.jsxs)("div",{className:"",children:[(0,N.jsx)("div",{className:"p-1 ",children:"Lounge"}),(0,N.jsx)("div",{className:"text-gray-600 text-xs flex justify-center",children:(0,N.jsx)("p",{children:"Available Groups"})}),(0,N.jsx)("div",{className:"Grpcontainer min-h-[80vh]",children:null===E||void 0===E?void 0:E.map((function(e,t){return(0,N.jsxs)("div",{onClick:function(){b((function(e){return G(),(0,o.Z)((0,o.Z)({},e),{},{activegroup:(0,o.Z)({},E[t])})}))},className:"w-full bg-gradient-to-r from-[#FFF5DA] rounded-md p-2 my-2 to-white shadow-tile flex hover:scale-105 cursor-pointer",children:[(0,N.jsx)("div",{className:"w-8 h-8 rounded-full p-2 bg-white flex justify-center items-center",children:(0,N.jsx)("img",{className:"rounded-full",src:c.Z,alt:"user"})}),(0,N.jsxs)("div",{className:"mx-2 w-[80%] flex items-center",children:[(0,N.jsx)("div",{className:"font-light text-sm w-1/2",children:e.groupName}),(0,N.jsxs)("div",{className:"w-1/2 border-l p-1 border-[#E9BB19] text-[8px]",children:[e.description.substring(0,20)," ..."]}),window.chatHistory&&window.chatHistory[e.groupName]&&window.chatHistory[e.groupName].unreadCount?(0,N.jsx)("div",{className:"py-1 px-2 float-right text-white font-black text-xs bg-amber-400 rounded",children:window.chatHistory[e.groupName].unreadCount}):""]})]},e.groupName)}))}),(0,N.jsxs)("div",{onClick:function(e){e.preventDefault(),h.ZP.loading("Upcoming feature, will be availablel soon",{duration:2500})},className:"px-4 mx-auto py-2 rounded-full w-fit flex shadow-edge bg-[#8ef57e] text-xs",children:[(0,N.jsx)("img",{src:w.Z,alt:"add group",width:"20px"}),(0,N.jsx)("button",{className:"mx-1",children:"Add Group"})]})]})})]})}}}]);