"use strict";(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[138],{9138:function(e,t,i){i.r(t),i.d(t,{default:function(){return J}});var n=i(1413),a=i(5671),s=i(3144),c=i(136),r=i(7277),o=i(7313),d=i(7224),l=i(5034),h=i(6125),u=i(7185);var m=i.p+"static/media/video.677cd1159b7927e2d347c93c66031b39.svg";var f=i.p+"static/media/microphone.0820806800c9da1c010c662a755d0017.svg";var v=i.p+"static/media/microphoneOff.86a8b67eec988bc8f7872f028e7e5b0e.svg";var g=i.p+"static/media/videoOff.ea7df9bf4a5e8adbfc63a6010dafd521.svg",p=i(8467),b=i(6446),S=i(3392),x=i(4165),w=i(5861),k={video:!0,audio:!0},j=function(){var e=(0,w.Z)((0,x.Z)().mark((function e(){return(0,x.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",i.g.navigator.mediaDevices.getUserMedia(k));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),C=i(9864),y=i(942),Z=i(1391),R={iceServers:[{url:"stun:stun.l.google.com:19302"},{url:"turn:192.158.29.39:3478?transport=udp",credential:"JZEOEt2V3Qb0y27GRntt2u2PAYA=",username:"28224511:1379330808"},{url:"turn:192.158.29.39:3478?transport=tcp",credential:"JZEOEt2V3Qb0y27GRntt2u2PAYA=",username:"28224511:1379330808"}]},M=function(){return new RTCPeerConnection(R)},T=function(){var e=(0,w.Z)((0,x.Z)().mark((function e(t,i,n){return(0,x.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i.on("Offer",function(){var e=(0,w.Z)((0,x.Z)().mark((function e(a){var s;return(0,x.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a.offer){e.next=9;break}return t.setRemoteDescription(new RTCSessionDescription(a.offer)),e.next=4,t.createAnswer();case 4:return s=e.sent,e.next=7,t.setLocalDescription(s);case 7:i.emit("Answer",s),n();case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)})));return function(t,i,n){return e.apply(this,arguments)}}(),N=i(9879),P=function(){function e(t,i){var n=this;(0,a.Z)(this,e),this.PeerConnection=M(),this.socketServer=t,this.PeerConnection.addEventListener("icecandidate",(function(e){e.candidate&&n.socketServer.emit("new-ice-candidate",{newIceCand:e.candidate,recepientId:C.Z.getState().SocConState.recepientId})})),this.socketServer.on("call",(function(e){n.PeerConnection.setRemoteDescription(e.offerObj),n.PeerConnection.createAnswer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then((function(e){n.PeerConnection.setLocalDescription(e).then((function(){n.socketServer.emit("answer",{recepientId:C.Z.getState().SocConState.recepientId,ansObj:e})}))}))})),this.socketServer.on("answer",(function(e){n.PeerConnection.setRemoteDescription(e.ansObj).then((function(){}))})),this.PeerConnection.addEventListener("icegatheringstatechange",(function(e){})),t.on("new-ice-candidate",(function(e){n.PeerConnection.addIceCandidate(e.newIceCand)})),this.PeerConnection.addEventListener("connectionstatechange",(function(e){switch(n.PeerConnection.connectionState){case"connected":C.Z.dispatch((0,N.Mt)());break;case"disconnected":C.Z.dispatch((0,N.dj)())}})),this.PeerConnection.addEventListener("track",(function(e){i({type:"Newtrack",track:e.track})}))}return(0,s.Z)(e,[{key:"resetConnction",value:function(){this.PeerConnection.close(),delete this.PeerConnection,this.socketServer.removeAllListeners("call"),this.socketServer.removeAllListeners("answer"),this.socketServer.removeAllListeners("new-ice-candidate"),C.Z.dispatch((0,N.dj)())}},{key:"AnswerCall",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};T(this.PeerConnection,this.socketServer,e)}},{key:"MakeCall",value:function(){var e=this;this.PeerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then((function(t){e.PeerConnection.setLocalDescription(t).then((function(){e.socketServer.emit("call",{recepientId:C.Z.getState().SocConState.recepientId,offerObj:t})}))}))}}]),e}(),A=i(8933),I=i(6306),V=i(2658),q=i(1577);var E=i.p+"static/media/mobileVid.33d46888344170217dda67acff708fe6.svg";var O=i.p+"static/media/mobileMic.3a12c07a70bfd4bb3dc283f817590c76.svg";var D=i.p+"static/media/MobileMicOff.a004870abafa4b735b6e1ee42a3961da.svg";var B=i.p+"static/media/mobVidOff.f6c8c813d756325ec968ece3f6bff4c4.svg",L=i(4725),F=i(4319),_=i(4949),G=i(9526),U=i(4873),z=i(6417),Y=function(e){(0,c.Z)(i,e);var t=(0,r.Z)(i);function i(e){var s;return(0,a.Z)(this,i),(s=t.call(this,e)).toggleAudiosharing=function(){s.setState((0,n.Z)((0,n.Z)({},s.state),{},{audioSharing:!s.state.audioSharing}))},s.toggleVideoSharing=function(){s.setState((0,n.Z)((0,n.Z)({},s.state),{},{videoSharing:!s.state.videoSharing}))},s.requestMatch=function(){s.state.matchRequested?s.setState((0,n.Z)((0,n.Z)({},s.state),{},{alertMsg:"Processing match request",alertType:"info"})):((0,U.yt)({eventType:"buttonclick",triggerelement:"match button"}),s.state.Socket.emit("MatchRequest",{mode:"video",name:s.props.authentication.name,age:s.props.authentication.age,gender:s.props.authentication.gender}),s.setState((0,n.Z)((0,n.Z)({},s.state),{},{matchRequested:!0})))},s.revokeMatch=function(){s.state.isMatched?((0,U.yt)({eventType:"buttonclick",triggerelement:"disconnect button"}),s.state.Socket.emit("MatchRevoked",{recepientId:s.state.recepientId}),s.initiateRTCreset()):s.setState((0,n.Z)((0,n.Z)({},s.state),{},{alertMsg:"You're not connected",alertType:"warning"}))},s.setRemoteStream=function(e){"Newtrack"===e.type?s.remoteStream.addTrack(e.track):e.type},s.makeCall=function(){s.state.isMatched?s.state.Rtc.MakeCall():s.setState({alertMsg:"Unable to connect other user, please verify matching",alertType:"danger"})},s.matchTimeup=function(){void 0!==s.state.Rtc&&s.initiateRTCreset()},s.state={redirect:s.props.authentication.name?void 0:"/",Socket:void 0,isMatched:s.props.SocConState.isMatched,recepientId:s.props.SocConState.recepientId,alertMsg:void 0,alertType:void 0,videoSharing:!0,audioSharing:!0,mediaStream:new MediaStream,Rtc:void 0,matchRequested:!1,mobileButtonVisible:!0,device:s.props.globalState.device},s.videoRef=o.createRef(),s.selfVidRef=o.createRef(),s.remoteStream=new MediaStream,s}return(0,s.Z)(i,[{key:"componentDidMount",value:function(){var e=this;(0,U.yt)({eventType:"PageLoad"}),this.props.authentication.name&&((new b.s).getSocket().then((function(t){e.setState((0,n.Z)((0,n.Z)({},e.state),{},{Socket:t,Rtc:new P(t,e.setRemoteStream)}),(function(){e.state.Socket.on("MatchRevoked",(function(){e.initiateRTCreset()}))}))})),j().then((function(t){e.state.mediaStream.getTracks().map((function(t){e.state.mediaStream.removeTrack(t)})),e.selfVidRef.current.srcObject=e.state.mediaStream,e.selfVidRef.current.play(),t.getTracks().map((function(i){e.state.mediaStream.addTrack(i),e.state.Rtc.PeerConnection.addTrack(i,t)})),e.videoRef.current.srcObject=e.remoteStream})))}},{key:"componentDidUpdate",value:function(){this.videoRef.current.play(),this.state.audioSharing?this.state.mediaStream.getAudioTracks().forEach((function(e){e.enabled=!0})):this.state.mediaStream.getAudioTracks().forEach((function(e){e.enabled=!1})),this.state.videoSharing?this.state.mediaStream.getVideoTracks().forEach((function(e){e.enabled=!0})):this.state.mediaStream.getVideoTracks().forEach((function(e){e.enabled=!1}))}},{key:"initiateRTCreset",value:function(){var e=this;window.sessionStorage.removeItem("recepientName"),window.sessionStorage.removeItem("recepientGender"),this.state.Rtc.resetConnction(),delete this.state.Rtc,this.remoteStream.getTracks().forEach((function(t){e.remoteStream.removeTrack(t)})),this.setState((0,n.Z)((0,n.Z)({},this.state),{},{matchRequested:!1,Rtc:new P(this.state.Socket,this.setRemoteStream)}),(function(){e.state.mediaStream.getTracks().forEach((function(t){e.state.Rtc.PeerConnection.addTrack(t,e.state.mediaStream)}))})),C.Z.dispatch((0,y.c4)())}},{key:"render",value:function(){var e=this;return(0,z.jsxs)("div",{children:[(0,z.jsxs)("div",{className:"h-[100vh] relative",children:[(0,z.jsx)(d.Z,{}),(0,z.jsx)(F.Z,{}),(0,z.jsxs)("div",{className:"h-fit",children:[this.state.redirect&&(0,z.jsx)(p.Fg,{to:this.state.redirect,replace:!0}),this.state.alertMsg&&(0,z.jsx)(Z.Z,{text:this.state.alertMsg,className:"z-10",callBack:function(){e.setState((0,n.Z)((0,n.Z)({},e.state),{},{alertMsg:void 0,alertType:void 0}))},type:this.state.alertType}),(0,z.jsxs)("div",{className:"w-3/5 mobile:w-full mobile:shadow mobile:rounded mobile:border-none mobile:m-0 mx-auto my-2 p-2 h-10 border-[1px] flex justify-between border-Primary",children:[(0,z.jsxs)("div",{className:"flex",children:[(0,z.jsx)("img",{src:l.Z,width:"20px"}),(0,z.jsx)("div",{className:" px-2 pt-1",children:window.sessionStorage.getItem("recepientName")?window.sessionStorage.getItem("recepientName"):"User Name"})]}),(0,z.jsx)("img",{className:"",src:"Male"===window.sessionStorage.getItem("recepientGender")?A:"Female"===window.sessionStorage.getItem("recepientGender")?I:V,width:"20px"}),(0,z.jsxs)("div",{className:"flex mobile:hidden",children:[(0,z.jsxs)("button",{disabled:this.state.isMatched,onClick:this.requestMatch,className:this.state.isMatched?"bg-[#d7dbd6] w-24 h-6 flex justify-evenly items-center rounded-full text-xs":"bg-[#A7FB9A] hover:bg-[#8ef57e] hover:shadow-xl w-24 h-6 flex justify-evenly items-center rounded-full text-xs",children:[(0,z.jsx)("img",{width:"15px",src:h.Z}),this.state.matchRequested?(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(q.Z,{size:4}),"desktop"==this.state.device?(0,z.jsx)(_.Z,{countdown:15,callback:this.matchTimeup}):void 0]}):"Match"]}),(0,z.jsxs)("button",{disabled:!this.state.isMatched,onClick:this.revokeMatch,className:"w-24 h-6 mx-2 flex justify-evenly items-center rounded-full text-xs ".concat(this.state.isMatched?"bg-[#FBB19A] hover:bg-[#f79b80] hover:shadow-xl":"bg-[#d7dbd6]"),children:[(0,z.jsx)("img",{width:"15px",src:u.Z}),"Disconnect"]})]})]}),(0,z.jsxs)("div",{className:"w-3/5 mobile:w-full mobile:h-[50vh] mx-auto flex h-[80vh] bg-dark_cyan",children:[(0,z.jsxs)("div",{className:"w-[92%] mobile:w-full relative",children:[(0,z.jsx)("video",{ref:this.videoRef,className:"bg-light_gray",style:{width:"100%",height:"100%"}}),(0,z.jsx)("video",{ref:this.selfVidRef,style:{width:"20%",height:"30%"},className:"absolute bottom-0 right-0"})]}),(0,z.jsxs)("div",{className:"mobile:hidden w-[8%] bg-gold flex flex-col justify-center items-center",children:[(0,z.jsx)("img",{className:"my-2 cursor-pointer",onClick:this.toggleVideoSharing,src:this.state.videoSharing?m:g,width:"25px"}),(0,z.jsx)("img",{className:"my-2 cursor-pointer",onClick:this.toggleAudiosharing,src:this.state.audioSharing?f:v,width:"25px"})]})]}),(0,z.jsx)("div",{className:"hidden mobile:show",children:(0,z.jsxs)("div",{className:"flex justify-evenly",children:[(0,z.jsx)("div",{onClick:this.toggleVideoSharing,className:"border border-light_gray rounded-full h-16 shadow w-16 flex justify-center items-center",children:(0,z.jsx)("img",{src:this.state.videoSharing?E:B,width:"25px"})}),(0,z.jsx)("div",{onClick:this.toggleAudiosharing,className:"border border-light_gray rounded-full h-16 shadow w-16 flex justify-center items-center",children:(0,z.jsx)("img",{src:this.state.audioSharing?O:D,width:"25px"})})]})})]}),(0,z.jsxs)("div",{className:"hidden mobile:show w-full h-fit mt-8 rounded-md bg-[#aaa8a850] absolute bottom-0",children:[(0,z.jsx)("div",{className:"w-full flex justify-center",onClick:function(){return e.setState((0,n.Z)((0,n.Z)({},e.state),{},{mobileButtonVisible:!e.state.mobileButtonVisible}))},children:(0,z.jsx)("img",{src:L.Z,className:" bg-white rounded-b-md"})}),this.state.mobileButtonVisible&&(0,z.jsxs)("div",{className:"flex justify-around",children:[(0,z.jsx)("button",{className:"w-12 h-12 shadow flex p-2 justify-center items-center rounded-full ".concat(this.state.isMatched?"bg-[#d7dbd6]":"bg-[#A7FB9A]","\n\t\t\t\t\t\t\t\t\t\ttext-[8px] font-semibold hover:bg-[#8ef57e] hover:shadow-xl"),disabled:this.state.isMatched,onClick:this.requestMatch,children:this.state.matchRequested?(0,z.jsx)(q.Z,{size:4}):"Connect"}),this.state.matchRequested&&"mobile"===this.state.device?(0,z.jsx)(_.Z,{countdown:15,callback:this.matchTimeup}):void 0,(0,z.jsx)("button",{className:"w-12 h-12 flex p-2 justify-center items-center rounded-full bg-[#FBB19A] text-[8px] hover:bg-[#f79b80] hover:shadow-lg font-semibold",onClick:this.revokeMatch,children:"Disconnect"})]})]})]}),(0,z.jsx)(G.Z,{})]})}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e.SocConState.recepientId!==t.recepientId&&""!==e.SocConState.recepientId&&e.SocConState.initCall&&t.Rtc&&t.Rtc.MakeCall(),(0,n.Z)((0,n.Z)({},t),{},{isMatched:e.SocConState.isMatched,recepientId:e.SocConState.recepientId,matchRequested:e.SocConState.isMatched?!e.SocConState.isMatched:t.matchRequested,device:e.globalState.device})}}]),i}(o.Component);var J=(0,S.$j)((function(e){return(0,n.Z)({},e)}))(Y)}}]);