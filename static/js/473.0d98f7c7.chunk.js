"use strict";(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[473],{7473:(e,t,s)=>{s.r(t),s.d(t,{default:()=>O});var i=s(9950),a=s(2832),c=s(9881),n=s(8947),o=s(9182);const r=s.p+"static/media/video.677cd1159b7927e2d347c93c66031b39.svg";const d=s.p+"static/media/microphone.0820806800c9da1c010c662a755d0017.svg";const h=s.p+"static/media/microphoneOff.86a8b67eec988bc8f7872f028e7e5b0e.svg";const l=s.p+"static/media/videoOff.ea7df9bf4a5e8adbfc63a6010dafd521.svg";var m=s(8429),g=s(346),u=s(8341);const f={video:!0,audio:!0};var v=s(9749),p=s(9465),b=s(3236);const S={iceServers:[{url:"stun:stun.l.google.com:19302"},{url:"turn:192.158.29.39:3478?transport=udp",credential:"JZEOEt2V3Qb0y27GRntt2u2PAYA=",username:"28224511:1379330808"},{url:"turn:192.158.29.39:3478?transport=tcp",credential:"JZEOEt2V3Qb0y27GRntt2u2PAYA=",username:"28224511:1379330808"}]};var x=s(4921);class w{constructor(e,t){this.PeerConnection=new RTCPeerConnection(S),this.socketServer=e,this.PeerConnection.addEventListener("icecandidate",(e=>{e.candidate&&this.socketServer.emit("new-ice-candidate",{newIceCand:e.candidate,recepientId:v.A.getState().SocConState.recepientId})})),this.socketServer.on("call",(e=>{this.PeerConnection.setRemoteDescription(e.offerObj),this.PeerConnection.createAnswer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then((e=>{this.PeerConnection.setLocalDescription(e).then((()=>{this.socketServer.emit("answer",{recepientId:v.A.getState().SocConState.recepientId,ansObj:e})}))}))})),this.socketServer.on("answer",(e=>{this.PeerConnection.setRemoteDescription(e.ansObj).then((()=>{}))})),this.PeerConnection.addEventListener("icegatheringstatechange",(e=>{})),e.on("new-ice-candidate",(e=>{this.PeerConnection.addIceCandidate(e.newIceCand)})),this.PeerConnection.addEventListener("connectionstatechange",(e=>{switch(this.PeerConnection.connectionState){case"connected":v.A.dispatch((0,x.DK)());break;case"disconnected":v.A.dispatch((0,x.L_)())}})),this.PeerConnection.addEventListener("track",(e=>{t({type:"Newtrack",track:e.track})}))}resetConnction(){this.PeerConnection.close(),delete this.PeerConnection,this.socketServer.removeAllListeners("call"),this.socketServer.removeAllListeners("answer"),this.socketServer.removeAllListeners("new-ice-candidate"),v.A.dispatch((0,x.L_)())}AnswerCall(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:()=>{};(async(e,t,s)=>{t.on("Offer",(async i=>{if(i.offer){e.setRemoteDescription(new RTCSessionDescription(i.offer));const a=await e.createAnswer();await e.setLocalDescription(a),t.emit("Answer",a),s()}}))})(this.PeerConnection,this.socketServer,e)}MakeCall(){this.PeerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then((e=>{this.PeerConnection.setLocalDescription(e).then((()=>{this.socketServer.emit("call",{recepientId:v.A.getState().SocConState.recepientId,offerObj:e})}))}))}}var k=s(1277),C=s(2974),j=s(8632),R=s(2351);const y=s.p+"static/media/mobileVid.33d46888344170217dda67acff708fe6.svg";const A=s.p+"static/media/mobileMic.3a12c07a70bfd4bb3dc283f817590c76.svg";const M=s.p+"static/media/MobileMicOff.a004870abafa4b735b6e1ee42a3961da.svg";const T=s.p+"static/media/mobVidOff.f6c8c813d756325ec968ece3f6bff4c4.svg";var N=s(7246),I=s(1840),P=s(3143),V=s(3999),q=s(4127),D=s(4414);class E extends i.Component{static getDerivedStateFromProps(e,t){return e.SocConState.recepientId!==t.recepientId&&""!==e.SocConState.recepientId&&e.SocConState.initCall&&t.Rtc&&t.Rtc.MakeCall(),{...t,isMatched:e.SocConState.isMatched,recepientId:e.SocConState.recepientId,matchRequested:e.SocConState.isMatched?!e.SocConState.isMatched:t.matchRequested,device:e.globalState.device}}constructor(e){super(e),this.toggleAudiosharing=()=>{this.setState({...this.state,audioSharing:!this.state.audioSharing})},this.toggleVideoSharing=()=>{this.setState({...this.state,videoSharing:!this.state.videoSharing})},this.requestMatch=()=>{this.state.matchRequested?this.setState({...this.state,alertMsg:"Processing match request",alertType:"info"}):((0,q.Rt)({eventType:"buttonclick",triggerelement:"match button"}),this.state.Socket.emit("MatchRequest",{mode:"video",name:this.props.authentication.name,age:this.props.authentication.age,gender:this.props.authentication.gender}),this.setState({...this.state,matchRequested:!0}))},this.revokeMatch=()=>{this.state.isMatched?((0,q.Rt)({eventType:"buttonclick",triggerelement:"disconnect button"}),this.state.Socket.emit("MatchRevoked",{recepientId:this.state.recepientId}),this.initiateRTCreset()):this.setState({...this.state,alertMsg:"You're not connected",alertType:"warning"})},this.setRemoteStream=e=>{"Newtrack"===e.type?this.remoteStream.addTrack(e.track):e.type},this.makeCall=()=>{this.state.isMatched?this.state.Rtc.MakeCall():this.setState({alertMsg:"Unable to connect other user, please verify matching",alertType:"danger"})},this.matchTimeup=()=>{void 0!==this.state.Rtc&&this.initiateRTCreset()},this.state={redirect:this.props.authentication.name?void 0:"/",Socket:void 0,isMatched:this.props.SocConState.isMatched,recepientId:this.props.SocConState.recepientId,alertMsg:void 0,alertType:void 0,videoSharing:!0,audioSharing:!0,mediaStream:new MediaStream,Rtc:void 0,matchRequested:!1,mobileButtonVisible:!0,device:this.props.globalState.device},this.videoRef=i.createRef(),this.selfVidRef=i.createRef(),this.remoteStream=new MediaStream}componentDidMount(){this.props.authentication.name&&((new g.y).getSocket().then((e=>{this.setState({...this.state,Socket:e,Rtc:new w(e,this.setRemoteStream)},(()=>{this.state.Socket.on("MatchRevoked",(()=>{this.initiateRTCreset()}))}))})),(async()=>s.g.navigator.mediaDevices.getUserMedia(f))().then((e=>{this.state.mediaStream.getTracks().map((e=>{this.state.mediaStream.removeTrack(e)})),this.selfVidRef.current.srcObject=this.state.mediaStream,this.selfVidRef.current.play(),e.getTracks().map((t=>{this.state.mediaStream.addTrack(t),this.state.Rtc.PeerConnection.addTrack(t,e)})),this.videoRef.current.srcObject=this.remoteStream})))}componentDidUpdate(){this.videoRef.current.play(),this.state.audioSharing?this.state.mediaStream.getAudioTracks().forEach((e=>{e.enabled=!0})):this.state.mediaStream.getAudioTracks().forEach((e=>{e.enabled=!1})),this.state.videoSharing?this.state.mediaStream.getVideoTracks().forEach((e=>{e.enabled=!0})):this.state.mediaStream.getVideoTracks().forEach((e=>{e.enabled=!1}))}initiateRTCreset(){window.sessionStorage.removeItem("recepientName"),window.sessionStorage.removeItem("recepientGender"),this.state.Rtc.resetConnction(),delete this.state.Rtc,this.remoteStream.getTracks().forEach((e=>{this.remoteStream.removeTrack(e)})),this.setState({...this.state,matchRequested:!1,Rtc:new w(this.state.Socket,this.setRemoteStream)},(()=>{this.state.mediaStream.getTracks().forEach((e=>{this.state.Rtc.PeerConnection.addTrack(e,this.state.mediaStream)}))})),v.A.dispatch((0,p.c1)())}render(){return(0,D.jsxs)("div",{children:[(0,D.jsxs)("div",{className:"h-[100vh] relative",children:[(0,D.jsx)(a.A,{}),(0,D.jsx)(I.A,{}),(0,D.jsxs)("div",{className:"h-fit",children:[this.state.redirect&&(0,D.jsx)(m.C5,{to:this.state.redirect,replace:!0}),this.state.alertMsg&&(0,D.jsx)(b.A,{text:this.state.alertMsg,className:"z-10",callBack:()=>{this.setState({...this.state,alertMsg:void 0,alertType:void 0})},type:this.state.alertType}),(0,D.jsxs)("div",{className:"w-3/5 mobile:w-full mobile:shadow mobile:rounded mobile:border-none mobile:m-0 mx-auto my-2 p-2 h-10 border-[1px] flex justify-between border-Primary",children:[(0,D.jsxs)("div",{className:"flex",children:[(0,D.jsx)("img",{src:c.A,width:"20px"}),(0,D.jsx)("div",{className:" px-2 pt-1",children:window.sessionStorage.getItem("recepientName")?window.sessionStorage.getItem("recepientName"):"User Name"})]}),(0,D.jsx)("img",{className:"",src:"Male"===window.sessionStorage.getItem("recepientGender")?k:"Female"===window.sessionStorage.getItem("recepientGender")?C:j,width:"20px"}),(0,D.jsxs)("div",{className:"flex mobile:hidden",children:[(0,D.jsxs)("button",{disabled:this.state.isMatched,onClick:this.requestMatch,className:this.state.isMatched?"bg-[#d7dbd6] w-24 h-6 flex justify-evenly items-center rounded-full text-xs":"bg-[#A7FB9A] hover:bg-[#8ef57e] hover:shadow-xl w-24 h-6 flex justify-evenly items-center rounded-full text-xs",children:[(0,D.jsx)("img",{width:"15px",src:n.A}),this.state.matchRequested?(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(R.A,{size:4}),"desktop"==this.state.device?(0,D.jsx)(P.A,{countdown:15,callback:this.matchTimeup}):void 0]}):"Match"]}),(0,D.jsxs)("button",{disabled:!this.state.isMatched,onClick:this.revokeMatch,className:"w-24 h-6 mx-2 flex justify-evenly items-center rounded-full text-xs ".concat(this.state.isMatched?"bg-[#FBB19A] hover:bg-[#f79b80] hover:shadow-xl":"bg-[#d7dbd6]"),children:[(0,D.jsx)("img",{width:"15px",src:o.A}),"Disconnect"]})]})]}),(0,D.jsxs)("div",{className:"w-3/5 mobile:w-full mobile:h-[50vh] mx-auto flex h-[80vh] bg-dark_cyan",children:[(0,D.jsxs)("div",{className:"w-[92%] mobile:w-full relative",children:[(0,D.jsx)("video",{ref:this.videoRef,className:"bg-light_gray",style:{width:"100%",height:"100%"}}),(0,D.jsx)("video",{ref:this.selfVidRef,style:{width:"20%",height:"30%"},className:"absolute bottom-0 right-0"})]}),(0,D.jsxs)("div",{className:"mobile:hidden w-[8%] bg-gold flex flex-col justify-center items-center",children:[(0,D.jsx)("img",{className:"my-2 cursor-pointer",onClick:this.toggleVideoSharing,src:this.state.videoSharing?r:l,width:"25px"}),(0,D.jsx)("img",{className:"my-2 cursor-pointer",onClick:this.toggleAudiosharing,src:this.state.audioSharing?d:h,width:"25px"})]})]}),(0,D.jsx)("div",{className:"hidden mobile:show",children:(0,D.jsxs)("div",{className:"flex justify-evenly",children:[(0,D.jsx)("div",{onClick:this.toggleVideoSharing,className:"border border-light_gray rounded-full h-16 shadow w-16 flex justify-center items-center",children:(0,D.jsx)("img",{src:this.state.videoSharing?y:T,width:"25px"})}),(0,D.jsx)("div",{onClick:this.toggleAudiosharing,className:"border border-light_gray rounded-full h-16 shadow w-16 flex justify-center items-center",children:(0,D.jsx)("img",{src:this.state.audioSharing?A:M,width:"25px"})})]})})]}),(0,D.jsxs)("div",{className:"hidden mobile:show w-full h-fit mt-8 rounded-md bg-[#aaa8a850] absolute bottom-0",children:[(0,D.jsx)("div",{className:"w-full flex justify-center",onClick:()=>this.setState({...this.state,mobileButtonVisible:!this.state.mobileButtonVisible}),children:(0,D.jsx)("img",{src:N.A,className:" bg-white rounded-b-md"})}),this.state.mobileButtonVisible&&(0,D.jsxs)("div",{className:"flex justify-around",children:[(0,D.jsx)("button",{className:"w-12 h-12 shadow flex p-2 justify-center items-center rounded-full ".concat(this.state.isMatched?"bg-[#d7dbd6]":"bg-[#A7FB9A]","\n\t\t\t\t\t\t\t\t\t\ttext-[8px] font-semibold hover:bg-[#8ef57e] hover:shadow-xl"),disabled:this.state.isMatched,onClick:this.requestMatch,children:this.state.matchRequested?(0,D.jsx)(R.A,{size:4}):"Connect"}),this.state.matchRequested&&"mobile"===this.state.device?(0,D.jsx)(P.A,{countdown:15,callback:this.matchTimeup}):void 0,(0,D.jsx)("button",{className:"w-12 h-12 flex p-2 justify-center items-center rounded-full bg-[#FBB19A] text-[8px] hover:bg-[#f79b80] hover:shadow-lg font-semibold",onClick:this.revokeMatch,children:"Disconnect"})]})]})]}),(0,D.jsx)(V.A,{})]})}}const O=(0,u.Ng)((function(e){return{...e}}))(E)}}]);